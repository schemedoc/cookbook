<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Chained_Comparisons"> Chained Comparisons </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
We might like to use syntax to describe a sequence of "chained" comparisons like
<p />
<pre>
    3 &lt;= x &lt; 5
</pre>
<p />
which can be expressed in Scheme as:
<p />
<div class="scheme">
  <pre>(<span class="keyword">and</span> (<span class="builtin">&lt;=</span> <span class="selfeval">3</span> <span class="variable">x</span>) (<span class="builtin">&lt;</span> <span class="variable">x</span> <span class="selfeval">5</span>))
</pre>
</div>
<p />
However, this evaluates <code>x</code> twice, so if we wanted to avoid that, we can use a let.
<div class="scheme">
  <pre>(<span class="keyword">let</span> ((<span class="variable">x-val</span> <span class="variable">x</span>))
  (<span class="keyword">and</span> (<span class="builtin">&lt;=</span> <span class="selfeval">3</span> <span class="variable">x-val</span>) (<span class="builtin">&lt;</span> <span class="variable">x-val</span> <span class="selfeval">5</span>)))
</pre>
</div>
<p />
But perhaps we'd like a little bit of syntactic sugar to make this go down easier.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
The following macro handles much of the messiness behind chained comparisons:
<div class="scheme">
  <pre><span class="comment">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
</span><span class="comment">;; chained comparisons syntax
</span><span class="comment">;; example: (chain x &lt; y &lt;= z) roughly translates to
</span><span class="comment">;;          (and (&lt; x y) (&lt;= y z)), minus the duplicated
</span><span class="comment">;;           evaluation.
</span>(<span class="keyword">define-syntax</span> <span class="variable">chain</span>
  (<span class="keyword">syntax-rules</span> ()
    ((<span class="variable">_</span> <span class="variable">x</span>) <span class="variable">x</span>)
    ((<span class="variable">_</span> <span class="variable">x</span> <span class="variable">op</span> <span class="variable">y</span>) (<span class="variable">op</span> <span class="variable">x</span> <span class="variable">y</span>))
    ((<span class="variable">_</span> <span class="variable">x</span> <span class="variable">op</span> <span class="variable">y</span> <span class="variable">rest</span> ...)
     (<span class="keyword">let</span> ((<span class="variable">y-val</span> <span class="variable">y</span>))
       (<span class="keyword">and</span> (<span class="variable">op</span> <span class="variable">x</span> <span class="variable">y-val</span>)
            (<span class="variable">chain</span> <span class="variable">y-val</span> <span class="variable">rest</span> ...))))))
</pre>
</div>
<p />
Once we have this macro, we can use it like this:
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">define</span> (<span class="variable">between-5-6?</span> <span class="variable">n</span>) (<span class="variable">chain</span> <span class="selfeval">5</span> <span class="builtin">&lt;</span> <span class="variable">n</span> <span class="builtin">&lt;</span> <span class="selfeval">6</span>))
<span class="builtin">&gt;</span> (<span class="variable">between-5-6?</span> <span class="selfeval">3</span>)
<span class="selfeval">#f</span>
<span class="builtin">&gt;</span> (<span class="variable">between-5-6?</span> <span class="selfeval">5</span>)
<span class="selfeval">#f</span>
<span class="builtin">&gt;</span> (<span class="variable">between-5-6?</span> <span class="selfeval">5.5</span>)
<span class="selfeval">#t</span>
<span class="builtin">&gt;</span> (<span class="keyword">define</span> (<span class="variable">id*</span> <span class="variable">x</span>)
    (<span class="builtin">display</span> <span class="variable">x</span>)
    (<span class="builtin">newline</span>)
    <span class="variable">x</span>)
<span class="builtin">&gt;</span> (<span class="variable">chain</span> (<span class="variable">id*</span> <span class="selfeval">3</span>) <span class="builtin">&lt;</span> (<span class="variable">id*</span> <span class="selfeval">4</span>) <span class="builtin">&gt;</span> (<span class="variable">id*</span> <span class="selfeval">2</span>))
<span class="selfeval">4</span>
<span class="selfeval">3</span>
<span class="selfeval">2</span>
<span class="selfeval">#t</span>
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
This mimics most of the behavior behind Python's chained comparison syntax (<a href="http://www.python.org/doc/ref/comparisons.html" target="_top">http://www.python.org/doc/ref/comparisons.html</a>).  It avoids having to evaluate a part of the chain until it has to.
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/DannyYoo">DannyYoo</a> - 03 Feb 2006
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/PearlsList">PearlsList</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
