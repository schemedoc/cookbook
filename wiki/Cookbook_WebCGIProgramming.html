<div id="contentbox">
 <div class="widget">
 <h2><a name="CGI_programming"> </a> <a href="/Cookbook/CGI">CGI</a> programming </h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You want to write scripts that follow the Common Gateway Interface,
aka <a href="/Cookbook/CGI">CGI</a>, for instance to request information to register new users to
your site.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
There are two major components in writing scripts for the Web, the
first one is to be able to write the HTML that will <em>initiate</em> the
execution of the script, and the other is to write the program that
will process the information received through the HTTP protocol.
<p />
<h4><a name="HTTP_forms"> </a> HTTP forms </h4>
<p />
We will presume that you know the basics, so here's a very simple example:
<p />
<pre>
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0
 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html&gt;
 &lt;head&gt;&lt;title&gt;Registration&lt;/title&gt;&lt;/head&gt;
 &lt;body&gt;
  &lt;h1&gt;Registration&lt;/h1&gt;
  &lt;p&gt;To register as a new user, simply fill out this form:&lt;/p&gt;
  &lt;form action="/servlets/doregister.ss" method="post"&gt;
   &lt;table border="0"&gt;
    &lt;tr&gt;&lt;td align="right"&gt; First &amp; last name: &lt;/td&gt;
        &lt;td&gt;&lt;input type="text" name="Name" size="40" value=""/&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td align="right"&gt; Email address: &lt;/td&gt;
        &lt;td&gt;&lt;input type="text" name="Email" size="40" value="" /&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td colspan="2" align="center"&gt; &lt;input type="submit" value=" Submit " /&gt;&lt;/td&gt;&lt;/tr&gt;
   &lt;/table&gt;
  &lt;/form&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<p />
This HTML form has two important bits of information, on the one hand
the <em>method</em> used to send the information from the browser to the
server, in this case <strong>post</strong>, which <em>packs</em> the information and sends
it to the server once you hit the <em>Submit</em> button.
<p />
On the other hand, we have the <em>action</em>, in this case an scheme
program that will handle the request, process the registration, and
return to the client.
<p />
<h4><a name="CGI_programming_in_Scheme"> </a> <a href="/Cookbook/CGI">CGI</a> programming in Scheme </h4>
<p />
PLT Scheme ships with a <a href="/Cookbook/CGI">CGI</a> library, <code>cgi.ss</code>, that will help you
handle this.  Lets review some of the nomenclature, or types, used by
this library:
<p />
<dl>
<dt> binding</dt><dd> an association of a form item with its value.
</dd>
<dt> bindings</dt><dd> a list of binding's.
</dd>
<dt> html-string</dt><dd> any text string that has been escaped according to HTML conventions.
</dd>
</dl>
<p />
It should be clear now that what we want to do in order to retrieve
the information provided by the user in the form is to
<em>get the bindings</em>, search for the values of the <code>Name</code>, and <code>Email</code> keys.
<p />
<div class="scheme">
  <pre>(<span class="keyword">let*</span> ((<span class="variable">b</span> (<span class="variable">get-bindings</span>))
       (<span class="variable">name</span> (<span class="variable">extract-binding/single</span> <span class="selfeval">"Name"</span> <span class="variable">b</span>))
       (<span class="variable">email</span> (<span class="variable">extract-binding/single</span> <span class="selfeval">"Email"</span> <span class="variable">b</span>)))
</pre>
</div>
<p />
We used <code>get-bindings</code>, which returns the whole set of bindings
delivered by the client.  Note that there is also a
<code>get-bindings/post</code>, and a <code>get-bindings/get</code>, which only work when
the <em>method</em> POST, and GET are used respectively, while <code>get-bindings</code>
determines the kind of method used, and invokes the appropriate
procedure.
<p />
<code>extract-binding/single</code> returns the value associated to the key
passed as its first argument in the set of bindings passed as its
second argument.  The result is either a string representing the
value, or a web page with an error, for instance when there was more
than one value associated to the key, or the key wasn't found.
<p />
When there is more than one value, or an unknown number of values,
associated to a single key, you should use <code>extract-bindings</code>, which
returns a list with zero, one, or many associations for the key.
<p />
After getting, and processing the information (validate it, store it
in a database, etc.), you will want to return to the client.  The
<code>cgi.ss</code> library provides one convenient way to do just that:
<p />
<div class="scheme">
  <pre>  (<span class="variable">generate-html-output</span>
   <span class="selfeval">"Thank you!"</span>
   (<span class="builtin">list</span> (<span class="variable">format</span> <span class="selfeval">"Dear ~a, "</span> <span class="variable">name</span>)
         <span class="selfeval">"We have received your information, and this completes the registration process. "</span>
         <span class="selfeval">"Thank you!"</span>))
</pre>
</div>
<p />
And that's it.  There are a couple of other procedures provided by the
<code>cgi.ss</code> library, but this should cover the basis.
<p />
<strong>Important:</strong> In order to actually be able to <em>run</em> this example
 (execute the small scheme script above), you need to have a Web
 server properly configured, the script has to reside in the right
 place and have the right permissions, and the URI depicted in the
 <em>action</em> field, <code>"/servlets/doregister.ss"</code>, must point to it.
<p />
-- <a href="/Main/FranciscoSolsona">FranciscoSolsona</a> - 06 Apr 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/WebRecipes">WebRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 030 </td>
</tr>
</table>
<p />
 </div>
</div>
