<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="The_missing_looping_constructs_w"> The "missing" looping constructs <code>while</code>, <code>repeat-until</code> and <code>for</code>. </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
The control constructs <code>while</code>, <code>repeat-until</code> and <code>for</code> are present in most mainstream programming languages, but nevertheless they are not found in the Scheme standard. What is used in Scheme?
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
These constructs can all be "emulated" by using normal (tail recursive) function calls.
However since  these constructs are used so often, there are some more convenient
syntactical sugar available. The two most used constructs are
using <span style="background : #FFFFCE;">
  <font color="#0000FF">named <code>let</code></font>
</span><a href="/edit/Cookbook/NamedLet?topicparent=Cookbook.IdiomLoopingConstructs">?</a> and the <code>do</code> construct.
<p />
It is best to think of the  <code>do</code> construct as a glorified "do-until"-loop. The simplest form of <code>do</code> is:
<p />
<div class="scheme">
  <pre>(<span class="keyword">do</span> ()
  [<span class="variable">test</span> <span class="variable">return-exp</span>]
  <span class="builtin">exp</span>
  ...)
</pre>
</div>
<p />
If <code>return-exp</code> is omitted then the return values is (void), "the invisible value"
(so named because it isn't printed in the interaction window).
<p />
At the beginning of each loop the <code>test</code> expression is evaluated.
If it's non false, then <code>return-exp</code> is evaluated and its return valuse is the value of the entire <code>do</code> -loop. If the test is false, the body expressions are evaluated sequentially. After the evaluation of the last body expression, a new loop is started.
<p />
<div class="scheme">
  <pre><span class="comment">; Example 1
</span><span class="comment">; WARNING: This is not good style.
</span><span class="comment">;          A better solution is found below.
</span>
                                  <span class="comment">; Pseudo Code
</span>(<span class="keyword">define</span> <span class="variable">i</span> <span class="selfeval">0</span>)                      <span class="comment">; i := 0
</span>(<span class="keyword">do</span> ()                            <span class="comment">; do
</span>  [(<span class="builtin">=</span> <span class="variable">i</span> <span class="selfeval">5</span>)]                       <span class="comment">;   until i=5
</span>  (<span class="builtin">display</span> <span class="variable">i</span>)                     <span class="comment">;       display i
</span>  (<span class="keyword">set!</span> <span class="variable">i</span> (<span class="builtin">+</span> <span class="variable">i</span> <span class="selfeval">1</span>)))               <span class="comment">;       i := i +1
</span>
<span class="comment">; displays: 01234
</span></pre>
</div>
<p />
<p />
The alternative to <code>do</code> namely <span style="background : #FFFFCE;">
  <font color="#0000FF">NamedLet</font>
</span><a href="/edit/Cookbook/NamedLet?topicparent=Cookbook.IdiomLoopingConstructs">?</a>  is a variant on the syntax of let which provides a more general looping construct than do and may also be used to express recursions. It has the almost the same syntax as a normal
let, but the variable <code>name</code> can be used in the body to repeat the execution of body with new values
for <code>var1</code> ... by calling name with the new values.
<div class="scheme">
  <pre>(<span class="keyword">let</span> <span class="variable">name</span> ([<span class="variable">var1</span> <span class="variable">exp1</span>]
           ...)
   <span class="variable">body</span>
   ...)
</pre>
</div>
The list of variables can be empty.
<p />
<p />
Rewriting a normal <code>while</code> -loop is now easy:
<div class="scheme">
  <pre><span class="variable">while</span> <span class="variable">test</span>           (<span class="keyword">do</span> ()                 (<span class="keyword">let</span> <span class="variable">while</span> ()
  <span class="keyword">begin</span>                [(<span class="builtin">not</span> <span class="variable">test</span>)]           (<span class="keyword">when</span> <span class="variable">test</span>
    <span class="variable">exp1</span>               <span class="variable">exp1</span>                      <span class="variable">exp1</span>
    <span class="variable">exp2</span>               <span class="variable">exp2</span>                      <span class="variable">exp2</span>
    ...                ...)                      ...
  <span class="variable">end</span>                                            (<span class="variable">while</span>)))
</pre>
</div>
<p />
The (void) expression evaluates to the "invisible" value to indicate that the return value is not meant to be used. It is not printed by the interaction window (the REPL).
<p />
To write a <code>for</code> -loop with <code>do</code> requires us to look at the next simplest form of <code>do</code>:
<p />
<div class="scheme">
  <pre>(<span class="keyword">do</span> ([<span class="variable">var</span> <span class="variable">start-exp</span> <span class="variable">next-exp</span>])
  [<span class="variable">test</span> <span class="variable">return-exp</span>]
  <span class="builtin">exp</span>
  ...)
</pre>
</div>
<p />
The evaluation of the <code>do</code> -expression begins with the evaluation of <code>start-exp</code>. The result is bound to the variable <code>i</code> which is visible in both <code>next-exp</code> as well as <code>test</code>, <code>return-exp</code> and the body expressions. When the loop is restarted <code>next-exp</code> is evaluated and the variable <code>var</code> is rebound to the result, before the <code>test</code> expression and (possibly) the body is reevaluated.
<p />
<div class="scheme">
  <pre><span class="comment">; Example 2
</span>(<span class="keyword">do</span> ([<span class="variable">i</span> <span class="selfeval">0</span> (<span class="builtin">+</span> <span class="variable">i</span> <span class="selfeval">1</span>)])           (<span class="keyword">let</span> <span class="variable">loop</span> ([<span class="variable">i</span> <span class="selfeval">0</span>])
  [(<span class="builtin">=</span> <span class="variable">i</span> <span class="selfeval">5</span>)]                     (<span class="keyword">unless</span> (<span class="builtin">=</span> <span class="variable">i</span> <span class="selfeval">5</span>)
  (<span class="builtin">display</span> <span class="variable">i</span>))                     (<span class="builtin">display</span> <span class="variable">i</span>)
                                   (<span class="variable">loop</span> (<span class="builtin">+</span> <span class="variable">i</span> <span class="selfeval">1</span>))))
<span class="comment">; displays: 01234
</span></pre>
</div>
<p />
Now it is clear how to write a normal <code>for</code> loop with <code>do</code>:
<p />
<div class="scheme">
  <pre><span class="variable">for</span> <span class="variable">i=a</span> <span class="variable">to</span> <span class="variable">b</span> <span class="variable">step</span> <span class="variable">d</span>         (<span class="keyword">do</span> ([<span class="variable">i</span> <span class="variable">a</span> (<span class="builtin">+</span> <span class="variable">i</span> <span class="variable">d</span>)])          (<span class="keyword">let</span> <span class="variable">for</span> ([<span class="variable">i</span> <span class="variable">a</span>])
  <span class="keyword">begin</span>                       [(<span class="builtin">&gt;</span> <span class="variable">i</span> <span class="variable">b</span>)]                    (<span class="keyword">unless</span> (<span class="builtin">&gt;</span> <span class="variable">i</span> <span class="variable">b</span>)
    <span class="variable">exp1</span>                      <span class="variable">exp1</span>                            <span class="variable">exp1</span>
    <span class="variable">exp2</span>                      <span class="variable">exp2</span>                            <span class="variable">exp2</span>
    ...                       ...)                            ...
  <span class="variable">end</span>                                                         (<span class="variable">for</span> (<span class="builtin">+</span> <span class="variable">i</span> <span class="variable">d</span>))))
</pre>
</div>
<p />
The <code>repeat-until</code> loop is akward to write using <code>do</code>, but
using <span style="background : #FFFFCE;">
  <font color="#0000FF">named <code>let</code></font>
</span><a href="/edit/Cookbook/NamedLet?topicparent=Cookbook.IdiomLoopingConstructs">?</a> we can do as follows:
<p />
<div class="scheme">
  <pre><span class="variable">repeat</span>
  <span class="keyword">begin</span>        (<span class="keyword">let</span> <span class="variable">loop</span> ()         (<span class="keyword">let</span> <span class="variable">loop</span> ()
    <span class="variable">exp1</span>         <span class="variable">exp1</span>                 <span class="variable">exp1</span>
    <span class="variable">exp2</span>         <span class="variable">exp2</span>                 <span class="variable">exp2</span>
    ...          ...                  ...
  <span class="variable">end</span>            (<span class="keyword">if</span> (<span class="builtin">not</span> <span class="variable">test</span>)       (<span class="keyword">unless</span> <span class="variable">test</span> (<span class="variable">loop</span>)))
<span class="variable">until</span> <span class="variable">test</span>           (<span class="variable">loop</span>)))
</pre>
</div>
<p />
<p />
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a>
<p />
<h3>
  <a name="Comments"> Comments </a>
</h3>
<p />
If it doesn't complicate your discussion, perhaps you could emphasize
that Scheme makes it easy to code loops as recursive functions that
pass many or all of the values that change on each iteration.
And that it is very common to have named-<code>let</code> bind more
than one variable.
<p />
-- <a href="/Main/NeilVanDyke">NeilVanDyke</a> - 20 May 2004
<p />
A comment on a matter of style.  (Just mentioning this for consideration; I wouldn't go and change the discussion above, myself.)    I almost never use <code>do</code>.  Every time I want to, I have to
look it up to remind myself of the semantics.  I suspect <code>do</code> <em>might</em> also often obscure algorithmic improvements by biasing your code to fit its syntax (but I don't have <em>strong</em> anecdotal evidence of that, and don't use <code>do</code> often enough to be comfortable with it).  I originally thought <code>do</code> was some well-founded black-magic that would make me more powerful once I mastered it, but lately it seems to obscure more than it simplifies.  (Perhaps it captures some info that makes some compiler optimizations easier?)  So, lately,  I'm personally inclined to emphasize using named-<code>let</code>, <code>if</code>, <code>cond</code>, and <code>case</code>, and mention <code>do</code> more as an aside.
<p />
-- <a href="/Main/NeilVanDyke">NeilVanDyke</a> - 20 May 2004
<p />
I used to have the exact same opinion and to some degree still have.
However since I began pronoucing <code>do</code> as <code>do-until</code> it suddenly fell into place.
I see the above recipe as
    * an introduction to simple use of <code>do</code>
    * a place to refer people stating "Scheme doesn't have looping constructs"
    * show casing idiomatic uses of <code>do</code>
The example is not meant to show idiomatic loops, which <span style="background : #FFFFCE;">
  <font color="#0000FF">TailRecursion</font>
</span><a href="/edit/Cookbook/TailRecursion?topicparent=Cookbook.IdiomLoopingConstructs">?</a> and <span style="background : #FFFFCE;">
  <font color="#0000FF">NamedLoop</font>
</span><a href="/edit/Cookbook/NamedLoop?topicparent=Cookbook.IdiomLoopingConstructs">?</a>
ought to explain when written.
<p />
When <code>do</code> can be used it often looks pretty, but it isn't hard to
change to a named loop. One advantage of do compared to named lets is that
all the "loop logic" occurs at the top, where the initial value, the test
and the step functions are scattered around in the named loop.
<p />
Hm. Perhaps this recipe shoud be renamed <span style="background : #FFFFCE;">
  <font color="#0000FF">IdiomDo</font>
</span><a href="/edit/Cookbook/IdiomDo?topicparent=Cookbook.IdiomLoopingConstructs">?</a> ?
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 21 May 2004
<p />
I changed the presentation a little to include <span style="background : #FFFFCE;">
  <font color="#0000FF">NamedLet</font>
</span><a href="/edit/Cookbook/NamedLet?topicparent=Cookbook.IdiomLoopingConstructs">?</a>.
Is it better, or does it become more confusing?
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 21 May 2004
<p />
Shouldn't someone mention how to write <code>while</code>, <code>for</code> etc. using <code>syntax-rules</code> and/or <code>syntax-case</code>?  The discussion leaves that out, and these are powerful tools to solve exactly this kind of problem.
It's true that you usually don't need them for something as simple as this, but OTOH this provides a great opportunity to introduce the concept of hygienic macros in as simple a situation as possible.
<p />
-- <a href="/Main/MichaelVanier">MichaelVanier</a> - 17 Sep 2004
<p />
Feel free to add it either in the text or as a comment.
Or better perhaps a reference to a separate recipe in the macro chapter?
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 17 Sep 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/IdiomRecipes">IdiomRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left">  </td>
</tr>
</table>
<p />
 </div>
</div>
