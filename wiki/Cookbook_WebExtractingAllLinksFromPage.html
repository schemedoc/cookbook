<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Fetching_all_links_from_a_page"> Fetching all links from a page </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
Given an url, fetch the page, parse it and extract all links.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
We will use <code>string-&gt;url</code> and <code>get-pure-port</code> from <code>url.ss</code> to fetch the page. For parsing, <code>html-&gt;sxml</code> from the permissive HTML parser library <a href="/Cookbook/HtmlPrag">HtmlPrag</a> is used. Then <code>sxml-&gt;links</code> makes a recursive descent of the parse tree collecting all links it discovers.
<p />
<div class="scheme">
  <pre>(<span class="keyword">require</span> (<span class="variable">planet</span> <span class="selfeval">"htmlprag.ss"</span> (<span class="selfeval">"neil"</span> <span class="selfeval">"htmlprag.plt"</span>))
         (<span class="variable">lib</span> <span class="selfeval">"url.ss"</span> <span class="selfeval">"net"</span>)
         (<span class="variable">lib</span> <span class="selfeval">"match.ss"</span>))
<span class="comment">; url-&gt;sxml : url-string -&gt; sxml
</span><span class="comment">;  fetch the page with the url url, parse it and return the parse tree
</span>(<span class="keyword">define</span> (<span class="variable">url-&gt;sxml</span> <span class="variable">url</span>)
  (<span class="variable">html-&gt;sxml</span> (<span class="variable">get-pure-port</span> (<span class="variable">string-&gt;url</span> <span class="variable">url</span>))))
<span class="comment">; sxml-&gt;links : sxml -&gt; (list (list url-string string))
</span><span class="comment">;  return a list of all links in the parse tree
</span>(<span class="keyword">define</span> (<span class="variable">sxml-&gt;links</span> <span class="variable">sxml</span>)
  (<span class="variable">match</span> <span class="variable">sxml</span>
   [(<span class="keyword">'</span><span class="variable">a</span> (<span class="keyword">'</span><span class="variable">@</span> ((<span class="builtin">not</span> <span class="keyword">'</span><span class="variable">href</span> ) <span class="variable">_</span>) ... (<span class="keyword">'</span><span class="variable">href</span> <span class="variable">url</span>)  . <span class="variable">more</span>) <span class="variable">text</span>)
    (<span class="builtin">list</span> (<span class="builtin">list</span> <span class="variable">url</span> <span class="variable">text</span>))]
   [(<span class="variable">item</span> ...)
    (<span class="builtin">apply</span> <span class="builtin">append</span>
           (<span class="builtin">map</span> <span class="variable">sxml-&gt;links</span> <span class="variable">sxml</span>))]
   [<span class="keyword">else</span> <span class="keyword">'</span>()]))
</pre>
</div>
<p />
<h3>
  <a name="Examples"> Examples </a>
</h3>
<p />
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="variable">sxml-&gt;links</span> (<span class="variable">url-&gt;sxml</span> <span class="selfeval">"http://www.neilvandyke.org/htmlprag/"</span>))
((<span class="selfeval">"htmlprag.scm"</span> <span class="selfeval">"file htmlprag.scm"</span>)
 (<span class="selfeval">"htmlprag.html"</span> <span class="selfeval">"file htmlprag.html"</span>)
 (<span class="selfeval">"htmlprag.pdf"</span> <span class="selfeval">"file htmlprag.pdf"</span>)
 (<span class="selfeval">"htmlprag-0-7.plt"</span> <span class="selfeval">"file htmlprag-0-7.plt"</span>))
<span class="builtin">&gt;</span> (<span class="variable">url-&gt;sxml</span> <span class="selfeval">"http://www.neilvandyke.org/htmlprag/"</span>)
(<span class="global">*TOP*</span>
 (<span class="global">*PI*</span> <span class="variable">xml</span> <span class="selfeval">"version=\"1.0\" encoding=\"UTF-8\""</span>) <span class="selfeval">"\n"</span>
 (<span class="global">*DECL*</span> <span class="variable">DOCTYPE</span> ...
 (<span class="variable">html</span> ...
  (<span class="variable">head</span> ...
   (<span class="variable">title</span> <span class="selfeval">"Neil W. Van Dyke: HtmlPrag"</span>)   <span class="selfeval">"\n"</span>)  <span class="selfeval">"\n"</span>
  (<span class="variable">body</span> ...
   (<span class="variable">p</span> (<span class="variable">a</span> (<span class="variable">@</span> (<span class="variable">href</span> <span class="selfeval">"http://www.neilvandyke.org/"</span>)
            (<span class="variable">title</span> <span class="selfeval">"Home page of Neil W. Van Dyke"</span>)
            (<span class="variable">accesskey</span> <span class="selfeval">"0"</span>))
     (<span class="variable">b</span> <span class="selfeval">"neilvandyke"</span>)
     <span class="selfeval">".org"</span>))
    ...
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
The documentation on <a href="/Cookbook/HtmlPrag">HtmlPrag</a> can be found at <a href="http://planet.plt-scheme.org/300/docs/neil/htmlprag.plt/1/3/doc.txt" target="_top">http://planet.plt-scheme.org/300/docs/neil/htmlprag.plt/1/3/doc.txt</a>.
<p />
This code handles the general case where <code>href</code> can occur anywhere in the attribute list:
<p />
<pre>
   ('a                               ; a link
       ('@                           ; with a list of attributes
           ((not 'href ) _) ...      ; starting with zero or more non-hrefs
                ('href url)          ; then a href with the url
                . more)              ; then some more
       text)                         ; and finally the text of displayed
</pre>
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 19 Apr 2004 / 19 jan 2006
<p />
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 20 Apr 2004
<p />
<p />
<p />
<h3>
  <a name="Comments"> Comments </a>
</h3>
<p />
As a matter of interest, I once did something similar with SCSH, using its s-exp based regular expressions (SRE).  The actual regular expression used to match the links was:
<p />
<div class="scheme">
  <pre>(<span class="variable">rx</span> (<span class="variable">w/nocase</span> (<span class="selfeval">:</span> (<span class="keyword">or</span> <span class="selfeval">"href"</span> <span class="selfeval">"file"</span>) (<span class="builtin">*</span> <span class="variable">whitespace</span>) <span class="selfeval">"="</span> (<span class="builtin">*</span> <span class="variable">whitespace</span>) <span class="selfeval">"\""</span>
                 (<span class="variable">submatch</span> (<span class="builtin">*</span> (<span class="variable">~</span> (<span class="selfeval">"?\""</span>)))) <span class="selfeval">"\""</span>)))
</pre>
</div>
<p />
There's a bit more about this, with a more readable version of the above, in <a href="http://www.scsh.net/docu/post/srexamplurixtract.html" target="_top">this post</a>.
<p />
You could do the same thing in PLT with a string-based regexp.  Of course, HTMLPrag is likely to scale much better to more complex requirements.
<p />
-- <a href="/Main/AntonVanStraaten">AntonVanStraaten</a> - 19 Apr 2004
<p />
One problem with this solution is that it works only for anchor tags that have href as the first attribute.
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">sxml-&gt;links</span> <span class="variable">sxml</span>)
  (<span class="keyword">let</span> <span class="variable">loop</span> ([<span class="variable">sxml</span>  <span class="variable">sxml</span>]
             [<span class="variable">links</span> <span class="keyword">'</span>()])
    (<span class="variable">match</span> <span class="variable">sxml</span>
      [(<span class="keyword">'</span><span class="variable">a</span> (<span class="keyword">'</span><span class="variable">@</span> ((<span class="builtin">not</span> <span class="keyword">'</span><span class="variable">href</span> ) <span class="variable">_</span>) ... (<span class="keyword">'</span><span class="variable">href</span> <span class="variable">url</span>) . <span class="variable">more</span>) <span class="variable">text</span>) (<span class="builtin">cons</span> (<span class="builtin">list</span> <span class="variable">url</span> <span class="variable">text</span>) <span class="variable">links</span>)]
      [(<span class="variable">item</span> ...) (<span class="builtin">append</span> <span class="variable">links</span>
                          (<span class="builtin">apply</span> <span class="builtin">append</span>
                                 (<span class="builtin">map</span> <span class="variable">sxml-&gt;links</span> <span class="variable">sxml</span>)))]
      [<span class="keyword">else</span> <span class="variable">links</span>])))
</pre>
</div>
FYI, I had to <code>(require (lib "match.ss"))</code> to get this example to work.
<p />
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 20 Apr 2004
<p />
I have changed the solution to use your match expression
and added an explanation of what's going on.
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 24 Apr 2004
<p />
I updated the example to use the <a href="/Cookbook/PLaneT">PLaneT</a> version of <a href="/Cookbook/HtmlPrag">HtmlPrag</a>.
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 19 Jan 2006
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/WebRecipes">WebRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 020 </td>
</tr>
</table>
<p />
 </div>
</div>
