<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Testing_Whether_a_String_Represe"> Testing Whether a String Represents an Integer  </a>
</h2>
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You want to determine whether a string is an integer
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<pre>
string-&gt;integer STRING START END -&gt; INTEGER or #f
</pre>
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">string-&gt;integer</span> <span class="variable">str</span> <span class="variable">start</span> <span class="variable">end</span>)
  (<span class="keyword">and</span> (<span class="builtin">&lt;</span> <span class="selfeval">-1</span> <span class="variable">start</span> <span class="variable">end</span> (<span class="variable">inc</span> (<span class="builtin">string-length</span> <span class="variable">str</span>)))
    (<span class="keyword">let</span> <span class="variable">loop</span> ((<span class="variable">pos</span> <span class="variable">start</span>) (<span class="variable">accum</span> <span class="selfeval">0</span>))
      (<span class="keyword">cond</span>
        ((<span class="builtin">&gt;=</span> <span class="variable">pos</span> <span class="variable">end</span>) <span class="variable">accum</span>)
        ((<span class="builtin">char-numeric?</span> (<span class="builtin">string-ref</span> <span class="variable">str</span> <span class="variable">pos</span>))
          (<span class="variable">loop</span> (<span class="variable">inc</span> <span class="variable">pos</span>) (<span class="builtin">+</span> (<span class="builtin">char-&gt;integer</span> (<span class="builtin">string-ref</span> <span class="variable">str</span> <span class="variable">pos</span>))
              (<span class="builtin">-</span> (<span class="builtin">char-&gt;integer</span> <span class="selfeval">#\0</span>)) (<span class="builtin">*</span> <span class="selfeval">10</span> <span class="variable">accum</span>))))
        (<span class="keyword">else</span> <span class="selfeval">#f</span>)))))
</pre>
</div>
<p />
Here <code>inc</code> is a macro or a function that returns the incremented
argument. On many Scheme systems, it can be implemented more efficiently than merely <code>(+ 1 x)</code> if we assume that <code>x</code> is a fixnum.
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
This procedure checks to see if a substring of <code>STRING</code> from <code>START</code>
(inclusive) till <code>END</code> (exclusive) is a representation of a non-negative integer in decimal notation. If this is the case, this integer is returned.
<p />
    Otherwise -- when the substring contains non-decimal characters, or when the range from <code>START</code> till <code>END</code> is not within <code>STRING</code>, the result is <code>#f</code>.
<p />
    This procedure is a specialization of the standard <code>string-&gt;number</code>. The latter is far more general: for example, it will try to read strings like "1/2", "1S2", "1.34" and even "1/0" (the latter causing a zero-divide error). Note that to <code>string-&gt;number</code>, "1S2" is a valid representation of an inexact integer 100. Oftentimes we want to be more restrictive about what we consider a number: we want merely to read an integral label.
<p />
The obvious method is to use R5RS <code>string-&gt;number</code> as a test.    <code>string-&gt;number</code> can convert strings containing base 2, 8, 10, and 16 numbers into a number.  You can also force a conversion by formatting the number using Scheme conventions for specifying bases.  If the conversion can't be performed, <code>string-&gt;number</code> returns #f:
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"1234"</span>)
<span class="selfeval">1234</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"abc"</span> <span class="selfeval">16</span>)
<span class="selfeval">2748</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"77"</span> <span class="selfeval">8</span>)
<span class="selfeval">63</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"abc"</span> )
<span class="selfeval">#f</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"123abc"</span>)
<span class="selfeval">#f</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"778"</span> <span class="selfeval">8</span>)
<span class="selfeval">#f</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"#o11"</span> )
<span class="selfeval">9</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"#x11"</span> )
<span class="selfeval">17</span>
</pre>
</div>
This is only half the solution, however.  <code>string-&gt;number</code> works for any kind of number, so technically, you should wrap the call in a call to the <code>integer?</code> predicate:
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="builtin">integer?</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"77"</span> ))
<span class="selfeval">#t</span>
<span class="builtin">&gt;</span> (<span class="builtin">integer?</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"77.7"</span> ))
<span class="selfeval">#f</span>
</pre>
</div>
<p />
However, the simple solution has some notable drawbacks.  It must be noted that using <code>string-&gt;number</code> for testing if a string
represents an integer has notable drawbacks. Scheme's concept of number is a lot broader than most languages', so <code>string-&gt;number</code> is much more general than your typical programming language.  Scheme understands arbitrarily large numbers like 2 ^ 80, fractions such as 1/2, and imaginary numbers:
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"1208925819614629174706176"</span>)
<span class="selfeval">1208925819614629174706176</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"1/2"</span>)
<span class="selfeval">1/2</span>
<span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"0+1i"</span>)
<span class="selfeval">0+1i</span>
</pre>
</div>
<p />
Scheme's number facilities can lead to surprises. For example, on Petite Chez Scheme and Gambit,
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"1S0"</span>)
<span class="selfeval">1.0</span>
<span class="builtin">&gt;</span> (<span class="builtin">integer?</span> (<span class="builtin">string-&gt;number</span> <span class="selfeval">"1S0"</span>))
<span class="selfeval">#t</span>
</pre>
</div>
Not too many people would take "1S0" to mean an integer. It means an inexact integer.
<p />
There is even more serious problem. Often we test if a string
represents an integer when validating user input. It is
highly preferable if the test is a total predicate, that is,
generates no errors. However, <code>(string-&gt;number "1/0")</code>
will raise a run-time error.
<p />
-- <a href="/Main/OlegK">OlegK</a> - 14 Sep 2004  (corrected solution)
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 23 Apr 2004 (simple solution)
<p />
<h3>
  <a name="References"> References </a>
</h3>
<a href="http://pobox.com/~oleg/ftp/Scheme/util.html#misc-str-util" target="_top">http://pobox.com/~oleg/ftp/Scheme/util.html#misc-str-util</a>
<p />
<p />
<h3>
  <a name="Comments"> Comments </a>
</h3>
<p />
Oleg, two points: your text is below the STOPINCLUDE directive, which is where comments are supposed to live; this page would be more useful to the reader if you worked your correct solution into the body of the text with Gordon's solution.  I don't have time right now to make these changes or I would do them myself -- <a href="/Main/NoelWelsh">NoelWelsh</a> - 14 Sep 2004
<p />
I moved STOPINCLUDE; thank you for clarifying it. I thought about
how to merge two solutions, and the best I have come with is to
add one level of headers, and make a forward reference. Any hints
how to do the merging better?
Both solutions will work, depending on circumstances
<p />
-- <a href="/Main/OlegK">OlegK</a> - 14 Sep 2004
<p />
My preference is to give the <strong>correct</strong> solution (i.e. Oleg's) under solution and put the rest under discussion.  In this case, I put the discussion of the correct solution first and then went into a discussion of Scheme's number system, which leads into why <code>string-&gt;number</code> is insufficient.  Also, the definition of <code>inc</code> seems worthy of a recipe of its own under <a href="/Cookbook/NumberRecipes">NumberRecipes</a>, I think.
<p />
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 14 Sep 2004
<p />
Note that <code>inc</code> is called <code>add1</code> in <a href="/Cookbook/MzScheme">MzScheme</a>. In my opinion the portable solution <code>(+ x 1)</code> is in the context of a cookbook better (easier to grasp). Besides, most compilers ought to recognize this pattern anyway.
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 14 Sep 2004
<p />
Thank you both! Perhaps indeed one ought to use <code>(+ x 1)</code>
in the context of the cookbook. Regarding compiler's recognizing that pattern: Gambit and Bigloo are pretty good Scheme compilers. And yet,
if one looks into their source code, one sees
<code>(##fixnum.+ 1 index)</code> (in Gambit) or <code>(+fx 1 escape-mark)</code> (in Bigloo) all over the place. Incidentally, OCaml has <code>int-&gt;int</code>
primitives <code>succ</code> and <code>pred</code>, which are heavily used in its own
source code. That is a bit surprising considering that arithmetical
operations in Ocaml are monomorphic and 1 + x is easier to type.
<p />
-- <a href="/Main/OlegK">OlegK</a> - 15 Sep 2004
<p />
I forgot about the issue with fixnums. Replacing <code>(+ x 1)</code> with a
<code>(if (fixum? x) (fixnum-inc x) (general+ x 1)</code>, which I was thinking
of is easy. Detecting that <code>string-length</code> returns a fixnum is, as
you point out, in the case where redefinitions of predefined functions
are allowed somewhat harder. However, I must say that I thought the
type analysis phases in the Bigloo, Gambit and OCaml compilers were
able to make the proper optimization.
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 15 Sep 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/StringRecipes">StringRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 200 </td>
</tr>
</table>
<p />
 </div>
</div>
