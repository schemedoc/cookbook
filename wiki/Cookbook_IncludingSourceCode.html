<div id="contentbox">
 <div class="widget">
 <h1>
  <a name="Including_Source_Code_in_the_Coo"> Including Source Code in the Cookbook </a>
</h1>
<p />
<h2>
  <a name="Keywords_and_Inline_Expressions"> Keywords and Inline Expressions </a>
</h2>
<p />
Keywords and other inline expressions can be highlighted and rendered in fixed font by surrounding them with "=" signs.  For example, the notorious function name, <code>call-with-current-continuation</code>, was just embedded there using the following syntax:
<p />
<pre>
=call-with-current-continuation=
</pre>
<p />
<h2>
  <a name="Small_Source_Code_Snippets"> Small Source Code Snippets </a>
</h2>
<p />
Small source code snippets can be formatted using the <a href="/TWiki/SyntaxHighlightingPlugin">SyntaxHighlightingPlugin</a> syntax, for example:
<p />
<pre>
%begin scheme%
(define hello
  (lambda ()
    (display "Hello, web page")))
%end%
</pre>
<p />
This results in the code being displayed as follows:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> <span class="variable">hello</span>
  (<span class="keyword">lambda</span> ()
    (<span class="builtin">display</span> <span class="selfeval">"Hello, web page"</span>)))
</pre>
</div>
<p />
<h2>
  <a name="Including_External_Code"> Including External Code  </a>
</h2>
<p />
For any non-trivial code, and perhaps even for some trivial code, it's better to keep the code separately from the book text.  Among other things, this will allow the code to be more easily run and tested within Scheme, as well as making it easier to package the code for distribution.
<p />
The current approach to including external code is that for each code sample, a topic should be created in the Scm web, for example Scm.Start1.  Note that using a <a href="/TWiki/WikiName">WikiName</a> may be helpful, but it's not essential in this case.  The raw source code should be stored in this topic - for now, simply cutting and pasting the source from a local copy should suffice, later we'll set up ways to manage this better.
<p />
Once the code is stored in a topic, it can be included in the book using syntax like this:
<p />
<pre>
%begin scheme%
%INCLUDE{"Scm.Start1"}%
%end%
</pre>
<p />
This results in the following:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">display-type</span> <span class="variable">x</span>)
  (<span class="keyword">cond</span>
   [(<span class="builtin">number?</span> <span class="variable">x</span>) (<span class="builtin">display</span> <span class="selfeval">"It's a number!"</span>)]
   [(<span class="builtin">string?</span> <span class="variable">x</span>) (<span class="builtin">display</span> <span class="selfeval">"It's a string!"</span>)]
   [<span class="keyword">else</span> (<span class="builtin">display</span> <span class="selfeval">"It's something else!"</span>)]))
</pre>
</div>
<p />
-- <a href="/Main/AntonVanStraaten">AntonVanStraaten</a> - 31 Mar 2004
<p />
<h2>
  <a name="Comments"> Comments </a>
</h2>
<p />
Is it possible to keep the original indenting?
I'm a little annoyed with the indenting on <a href="/Cookbook/StringRecipeDecodingBinaryMessages">StringRecipeDecodingBinaryMessages</a>. Looking closer, it seems
it the square brackets that are causing the problem (see the
so-expression).
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 01 Apr 2004
<p />
Looks like <a href="/TWiki/BeautifierPlugin">BeautifierPlugin</a> can't really handle Scheme properly, and fixing it looks like work (I looked at the Perl source; it's fairly primitive).  Browsing the <a href="http://twiki.org/cgi-bin/view/Plugins/PluginPackage" target="_top">plugin list at twiki.org</a>, I found and installed <a href="/TWiki/SyntaxHighlightingPlugin">SyntaxHighlightingPlugin</a>, which uses GNU <code>enscript</code> to do the highlighting.  I've changed <a href="/Cookbook/StringRecipeDecodingBinaryMessages">StringRecipeDecodingBinaryMessages</a> to use this - check it out and see what you think.  The tags you need look like this:
<p />
<pre>
%begin scheme%
(let ([a 0])
      [b 1])
  (+ a b))
%end%
</pre>
<p />
which produces this:
<div class="scheme">
  <pre>(<span class="keyword">let</span> ([<span class="variable">a</span> <span class="selfeval">0</span>])
      [<span class="variable">b</span> <span class="selfeval">1</span>])
  (<span class="builtin">+</span> <span class="variable">a</span> <span class="variable">b</span>))
</pre>
</div>
<p />
which improves on BeautifierPlugin's indentation:
<div class="fragment">
  <pre>
(<font color="brown">let</font> ([a 0])
  [b 1])
(+ a b))</pre>
</div>
<p />
Long term, I'm a little concerned that shelling out to <code>enscript</code> to format every code snippet could be hard work for the server, but for now I think it's OK.
<p />
BTW, <code>enscript</code> generates font elements with hardcoded colors, and I'm not crazy about the colors.  I have about a dozen lines of Perl lying around somewhere that translates this into CSS classes.  When I get a chance I'll patch that in, at which point the source highlighting will be under the control of the skin (and will even support per-user customization).
<p />
Noel, you previously mentioned Moshi's Scheme code formatting abilities.  Was that based on <a href="/Cookbook/WebIt">WebIt</a>, or do you have some other code for that?
<p />
-- <a href="/Main/AntonVanStraaten">AntonVanStraaten</a> - 01 Apr 2004
<p />
Moshi supports enscript.  In addition <a href="/Main/BrentFulgham">BrentFulgham</a> wrote some formatting code for the <a href="/Cookbook/OriginalCookbook">OriginalCookbook</a> and I've brutually hacked it into my Moshi install (not in CVS yet).  The code uses regexps and is in /doc/cookbook/fontify.ss
<p />
-- <a href="/Main/NoelWelsh">NoelWelsh</a> - 02 Apr 2004
<p />
Anton, the enscript output is much better. Changing the colors of it
much be relatively easy. If it turns out to be slow, we must
figure out a way to cache the pages, so only new code snippets
are passed to enscript.
<p />
Not that long ago I looked at the source of the source highlighter
of the syntax checker tool, because I wanted to add a "Save highlighted code as HTML"-button. I was hoping to steal/reuse a function returning the code as syntax objects with color properties.
However I had a hard time grasping the relation to the GUI as
such, so I dropped the idea. It would however be cool to have
the same syntax highlighting as in <a href="/Cookbook/DrScheme">DrScheme</a>. The code is in <a href="http://download.plt-scheme.org/scheme/plt-clean-cvs/collects/drscheme/syncheck.ss" target="_top">syncheck.ss</a>.
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 02 Apr 2004
<p />
I've updated this topic to describe the new <a href="/TWiki/SyntaxHighlightingPlugin">SyntaxHighlightingPlugin</a> instead of <a href="/TWiki/BeautifierPlugin">BeautifierPlugin</a>.  I've also changed the converted cookbook pages to use this.  The new plugin has had the side-effect of fixing the <a href="/Cookbook/CookBook">CookBook</a> page so that it displays the whole (original) book, complete with source code.
<p />
I'm fine with enscript for now - I doubt we'll need to worry about performance for some time.  As you say, caching could adddress that.  Reusing PLT's Check Syntax sounds ambitious!  Their new "dumb" syntax highlighter might be easier.
<p />
-- <a href="/Main/AntonVanStraaten">AntonVanStraaten</a> - 03 Apr 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/AuthorRecipes">AuthorRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 050 </td>
</tr>
</table>
<p />
 </div>
</div>
