<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Building_a_Circular_List"> Building a Circular List </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
You want to build a list that's circular; that is, as you navigate it, you eventually reach the head again.  For example, ring buffers can be implemented with circular lists.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
If you <code>set-cdr!</code> on the <code>last-pair</code> of a list to the list, you have a circular list:
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">rb</span> <span class="keyword">'</span>(<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">4</span>))
<span class="builtin">&gt;</span> (<span class="builtin">set-cdr!</span> (<span class="variable">last-pair</span> <span class="variable">rb</span>) <span class="variable">rb</span>)
<span class="builtin">&gt;</span> <span class="variable">rb</span>
<span class="selfeval">#0=</span>(<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">4</span> . <span class="selfeval">#0#</span>)
</pre>
</div>
<p />
Note the odd notation the #0= at the start and the . #0# on the tail is telling you the list is circular.  Look at what the result of <code>cdr</code> is:
<p />
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="builtin">cdr</span> <span class="variable">rb</span>)
<span class="selfeval">#0=</span>(<span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">4</span> <span class="selfeval">1</span> . <span class="selfeval">#0#</span>)
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
Circular lists do require care when you're working with list functions, many functions will not accept a circular list, or will not terminate when given one.  The problem is in detecting the head of the list; if list elements aren't unique, you can't simply check if you've seen an element before.  In the ring buffer case, you probably have a fixed size ring buffer, so it's easiest just to keep track of how many elements you've seen when traversing a list and comparing to the known length.
<p />
<a href="/Cookbook/SRFI">SRFI</a>-1 also has functions <code>circular-list</code> for building circular lists and <code>circular-list?</code> for determining if a list is circular.
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="variable">circular-list</span> <span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">4</span>)
<span class="selfeval">#0=</span>(<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">4</span> . <span class="selfeval">#0#</span>)
</pre>
</div>
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 12 Aug 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/ListRecipes">ListRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
