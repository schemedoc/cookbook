<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Reading_An_Entire_Text_File"> Reading An Entire Text File </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You want to read the lines from a file and store them in a list.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">readlines</span> <span class="variable">filename</span>)
  (<span class="builtin">call-with-input-file</span> <span class="variable">filename</span>
    (<span class="keyword">lambda</span> (<span class="variable">p</span>)
      (<span class="keyword">let</span> <span class="variable">loop</span> ((<span class="variable">line</span> (<span class="variable">read-line</span> <span class="variable">p</span>))
                 (<span class="variable">result</span> <span class="keyword">'</span>()))
        (<span class="keyword">if</span> (<span class="builtin">eof-object?</span> <span class="variable">line</span>)
            (<span class="builtin">reverse</span> <span class="variable">result</span>)
            (<span class="variable">loop</span> (<span class="variable">read-line</span> <span class="variable">p</span>) (<span class="builtin">cons</span> <span class="variable">line</span> <span class="variable">result</span>)))))))
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<code>call-with-input-file</code> is an R5RS procedure that takes an arbitrary procedure of one argument and returns the result of that procedure.  The port opened by <code>call-with-input-file</code> will be closed upon return from the procedure given in the 2nd argument, however if the procedure never returns, the port won't be closed.  The <a href="/Cookbook/MzScheme">MzScheme</a> <code>call-with-input-file*</code> function will close the port even if control leaves the procedure passed to it.
<p />
Of course, if you want to read everything into a big string and process the string afterwards, you can define the following:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">read-all</span> <span class="variable">path</span>)
    (<span class="keyword">let</span> ((<span class="variable">size</span> (<span class="variable">file-size</span> <span class="variable">path</span>)))
      (<span class="builtin">call-with-input-file</span> <span class="variable">path</span>
        (<span class="keyword">lambda</span> (<span class="variable">p</span>)
          (<span class="variable">read-string</span> <span class="variable">size</span> <span class="variable">p</span>)))))
</pre>
</div>
<p />
<a href="/Cookbook/MzScheme">MzScheme</a>'s <code>call-with-input-file</code> accepts a third argument which allows you to specify <code>'text</code> or <code>'binary</code>, <code>'text</code> is used to handle platform differences in newlines.
<p />
Don't be fooled by <code>read</code>.  <code>read</code> is for reading S-Expressions from a port (i.e. Scheme code).  <code>readline</code> and <code>read-string</code> are for reading raw text.
<p />
Comparison with Python: <code>readlines</code> corresponds to <code>File.readlines()</code> and <code>read-all</code> to <code>File.read()</code>.
<p />
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
See another approach in <a href="/Cookbook/FileReadingLines">FileReadingLines</a>
<p />
<p />
<h3>
  <a name="another_approach"> another approach </a>
</h3>
<p />
this will
work and not be subject to race conditions (all of the heavy lifting
is in copy-port):
<p />
<p />
<div class="scheme">
  <pre><span class="selfeval">#lang</span> <span class="variable">scheme</span>
(<span class="keyword">require</span> <span class="variable">scheme/port</span>)
(<span class="keyword">define</span> (<span class="variable">file-&gt;string</span> <span class="variable">f</span>)
 (<span class="keyword">let</span> ([<span class="variable">sp</span> (<span class="variable">open-output-string</span>)])
   (<span class="builtin">call-with-input-file</span> <span class="variable">f</span>
     (<span class="variable">&amp;#955</span><span class="comment">; (fp) (copy-port fp sp)))
</span>   (<span class="variable">get-output-string</span> <span class="variable">sp</span>)))
</pre>
</div>
<p />
but I do not recommend reading files into strings. Instead, it is much
better to just operate on the port if you possibly can.
<p />
-- <a href="http://list.cs.brown.edu/pipermail/plt-scheme/2008-November/028271.html" target="_top">http://list.cs.brown.edu/pipermail/plt-scheme/2008-November/028271.html</a>
<p />
It's worth reading the thread.
<p />
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 13 Aug 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/FileRecipes">FileRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 1 </td>
</tr>
</table>
<p />
 </div>
</div>
