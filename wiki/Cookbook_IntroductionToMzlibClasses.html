<div id="contentbox">
 <div class="widget">
  <p />
<p />
<p />
<h2>
  <a name="_lib_class_ss_Notes"> (lib "class.ss") Notes </a>
</h2>
<hr>
<p />
These are a set of notes I'm taking about learning the class system in
mzlib, the standard library that comes with mzscheme.  I'm not already
that familiar with it; for me, it's always a little hard for me to
learn from the existing reference documentation:
<p />
<a href="http://download.plt-scheme.org/doc/301/html/mzlib/mzlib-Z-H-4.html#node_chap_4" target="_top">http://download.plt-scheme.org/doc/301/html/mzlib/mzlib-Z-H-4.html#node_chap_4</a>
<p />
but that's precisely because it's doing its job at being a very terse
and dense repository of knowledge.
<p />
<p />
But since I'm also a bit dense, I'll try to write a leisurely-paced
tutorial on the class system, targeted toward Java or Python
programmers; it should help people who come from those backgrounds to
get a minimal foothold on using the standard OOP framework in
mzscheme.  Basically, this is the beginner's guide I wish someone had
written for me.
<p />
There's another guide to the OOP system that may be very helpful to people: <a href="http://people.cs.uchicago.edu/~robby/pubs/papers/aplas2006-fff.pdf" target="_top">Scheme with Classes, Mixins, and Traits</a>.
<p />
The OOP system in mzscheme is extensive enough that there are several
ways to express the same thing, and there are other places where the
system goes beyond the support that "mainstream" languages provide.
So these notes are certainly not supposed to be comprehensive.  Also,
I'm still a newbie, so some of what I write might be horribly wrong.
Feedback and corrections will be greatly appreciated.
<p />
I'll try to maintain a list of links on the bottom for supplementary
material.
<p />
<p />
<h2>
  <a name="First_steps"> First steps </a>
</h2>
<hr>
<p />
Like many of the subsystems in mzscheme, the class system is actually
a part of <strong>mzlib</strong>, and it's a bit surprising to realize that it's
treated as an optional add-on, just like any other module library.
<p />
If we start off <strong>mzscheme</strong> and try something obvious, like:
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
we see that <strong>class</strong> isn't even a syntactic keyword at this point.  So
let's begin by pulling in the class support.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Ok, that's progress, since we now see that the error message has
changed to say that we're just writing something syntactically silly.
<p />
<p />
<p />
<h2>
  <a name="Classes_are_people_too"> Classes are people too </a>
</h2>
<hr>
<p />
But now that we have class support, let's first start off with a
simple toy example.  In Java, we might see a beginning class like:
<p />
<table width="100%" border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td bgcolor="#FFFFFF">
      <pre>    <b><font color="#A020F0">public</font></b> <b><font color="#A020F0">class</font></b> Person <b><font color="#A020F0">extends</font></b> Object {
        <b><font color="#A020F0">public</font></b> String name;
        <b><font color="#A020F0">public</font></b> Person(String name) {
            <b><font color="#A020F0">this</font></b>.<b><font color="#A020F0">super</font></b>();
            <b><font color="#A020F0">this</font></b>.name = name;
        }
        <b><font color="#A020F0">public</font></b> <b><font color="#A020F0">void</font></b> sayHello() {
            System.out.println(<b><font color="#BC8F8F">"hello, my name is "</font></b> + <b><font color="#A020F0">this</font></b>.name);
        }
    }</pre>
    </td>
  </tr>
</table>
<p />
which demonstrates how to define a Java class with a constructor and a
simple method for salutation's sake.  [Side note: In Java, some of the
things above can be left out, like the <strong>extends Object</strong> part.  But to
make things easier to see in comparison to mzscheme's class system,
I'm making those constructs explicit.  Also, we're making name a public
attribute for the moment, though we'll touch on privacy in just a moment.]
<p />
<p />
Let's see what this looks like in <strong>mzscheme</strong>:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Ok, this is not too different from Java.  The conventional way to name
a mzscheme class is to use a <strong>%</strong> suffix on the class name, and I'll
follow that convention for the rest of this tutorial.  We also see
that there is already a built-in <strong>object%</strong> base class:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Ok, now that we have a simple <strong>person%</strong> class defined, how do we
make people?  In Java, we'd say:
<p />
<table width="100%" border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td bgcolor="#FFFFFF">
      <pre>    Person p = <b><font color="#A020F0">new</font></b> Person(<b><font color="#BC8F8F">"mccarthy"</font></b>);</pre>
    </td>
  </tr>
</table>
<p />
In <strong>mzscheme</strong>, we can fire off an instantiation similarly:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<strong>new</strong> is a special form that allows us to make instances of classes,
and as we can see here, it can take class name and parameters that we
use to initialize our instance and its fields.
<p />
There are other ways of instantiating objects:
<p />
<ul>
<li> make-object
</li>
</ul>
<p />
<ul>
<li> instantiate
</li>
</ul>
<p />
The differences between these forms has to do with the way we pass
initial parameters to our instances.  <strong>new</strong> gives us the option to
pass things via keywords, <strong>make-object</strong> allows us to pass values
positionally, and <strong>instantiate</strong> allows both positional and keyword
arguments.
<p />
For these notes, we'll be using <strong>new</strong> just because, well, I want these
notes to be as simple as I can.
<p />
<p />
<p />
All subclasses must call the subclass's <strong>super</strong> initializer, just to
ensure that everything's initialized properly.  But out of curiosity, what
happens if we don't?  Let's make a quick class that doesn't call
<strong>super-new</strong>.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
We don't see anything break yet, but if we start trying to use the
class, we'll see problems:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<p />
So we end up seeing a runtime error during instance instantiation, and
the error message accurately reflects this.
<p />
(Also note that the error message mentions "instantiate" --- I guess
this means that <strong>new</strong> expands out to a call to the more general
<strong>instantiate</strong> form.)
<p />
<p />
<p />
Of course, once we have such an instance, we need to know how to fire
messages off to an instance.  In Java, we do this by using dot-notation:
<p />
<table width="100%" border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td bgcolor="#FFFFFF">
      <pre>    p.sayHello();</pre>
    </td>
  </tr>
</table>
<p />
In mzscheme, we use the <strong>send</strong> form to send a message off:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
And that's our first example.
<p />
<p />
<p />
<p />
<h2>
  <a name="_when_new_person_name_harry_met_"> (when ((new person% (name "harry")) . met . (new person% (name "sally")))) </a>
</h2>
<hr>
<p />
Let's try another <strong>person%</strong> example where people can meet other people.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<p />
Like the first example, we define each person to have a name, but we
also give them a list of friends.  And because these people didn't
live through the liberating sixties, a person's list of friend's is a
bit closed and private.
<p />
<p />
Let's make a few people, and have a social gathering.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
One thing to notice that <strong>get-field</strong> lets us peek into the public
fields of a class:
<p />
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<p />
But because <strong>friends</strong> isn't defined to be a public field, we can't just dig into a person's mind and violate their privacy.
<p />
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
We can get a little creepy, though, and can make it so that this is open:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
where <strong>friends</strong> is now a public field.
<p />
Following on that idea, if we are used to enforcing object
encapsulation, having all this openness is a bit disconcerting.  If
we're really paranoid, we can go to an extreme and do something like
this:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
And now we have something that simulates really strict privacy.
<p />
But a more idiomatic way of doing this uses an intialization parameter that then serves as the base of a private field.
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
in which case we only use <strong>name</strong> here as the public-facing interface to an instance's instantiation.  Internally, we stick with <strong>-name</strong>.  This uses the <strong>init</strong> form to break things down to this level of granularity.
<p />
<p />
<h2>
  <a name="Inheritance"> Inheritance </a>
</h2>
<hr>
<p />
Let's look at a <strong>person%</strong> definition that has the features we've talked about so far:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
But isn't it peculiar that everyone answers the same way?  One
limitation of <strong>person%</strong> is that a person will say-hello with the same
generic phrase, and that a <strong>person%</strong> will meet-all in the same way.
That is what a class is all about --- to define a regular behavior ---
but sometimes, we'd like to extend that behavior.
<p />
<p />
Let's add some diversity.  Let's say that we'd like to create another
kind of person that behaves the same as the <strong>person%</strong>, well, except that
their lingo is slightly different.  Let's see what that might look
like:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<p />
Here we have a new class called <strong>valley-person%</strong> that extends our
<strong>person%</strong> class.  By extension, we mean that it does everything a
<strong>person%</strong> would do, except in the cases that we explicitely override.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
In contrast to Java, we have to be a little more explicit when we
relate to our superclass.  In particular, any superclass fields that
we'd like to access from our subclass are the ones that we'll name
using <strong>inherit-field</strong>.  Furthermore, any functions we'd like to override
will be marked by our use of the <strong>define/override</strong> form.
<p />
<p />
Let's bring someone else into the party.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Hmmm..  luke is not quite as warm to leia as leia is.  Our version of
<strong>valley-person%</strong> is not gregarious in the sense that <strong>add-friend</strong> is a bit
asymmetric.  Let's fix that.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Now our <strong>valley-person%</strong> can <strong>do-lunch</strong> with another person.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Gnarly.  These people do have a particularly dark-sided way of meeting
each other.  Sins of the father superclass, I suppose.
<p />
<p />
One thing to note is that when leia does lunch with luke, she *send*s
herself an <strong>add-friend</strong> message, and also gets luke to add herself as
a friend.  The identifier <strong>this</strong> is there so that leia can send
messages to herself.
<p />
<p />
Another thing to realize is that this message passing is all being
done at run-time: we could just as easily ask leia to try dancing,
with an error message showing up only as the point where we call <strong>send</strong>:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
An alternative approach to the above class definition looks like this,
with one less <strong>this</strong>:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
The difference here is that our first call to <strong>add-friend</strong> explicitly
reuses the add-friend method by inheritence.  Rather than use <strong>send</strong>
to trigger an external message to ourselves, we're directly calling
our inherited method.
<p />
<p />
Why would we want to call inherited --- actually, any! --- methods this way, if we already
have <strong>send</strong>?  One advantage of doing it this way is that
<strong>valley-person%</strong> can check at class-creation time that its superclass
does have an <strong>add-friend</strong> method, so that we can do earlier error
trapping.  That is, although:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
will compile fine and error out when we call do-lunch, the alternative
will break as soon as we try defining the class:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Early error messages are nicer than late ones.  By using the second
form ---- by using <strong>inherit</strong> to access methods on <strong>this</strong>, we can add an
additional level of checking to catch typos as early as we can.
<strong>inherit</strong> obligates the superclass to have the method we'd like to
inherit.
<p />
(In general, we should consider <strong>send</strong> to be the message
passing form we use to send external messages to other objects.)
<p />
This might seem a little weird to Java people: isn't it just
blindingly obvious by looking at the superclass what methods belong in
there?  A class must have a fixed superclass, right?  It's right in
the class definition!  In Java, this would be true.  But things can be
different in mzscheme, and that's what the next section is about.
<p />
<p />
<p />
<h2>
  <a name="Mixing_things_up_with_Mixins"> Mixing things up with Mixins </a>
</h2>
<hr>
<p />
We're going to mix things up by changing our domain from people to
containers.  One common thing that people might like to do is "fold"
across lists or vectors.  Let's write this:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
And let's try this out.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Ok, looks good so far.  With this, we might later want to reusing
these classes, but with some additional functionality.  For example,
what if we'd like to have <strong>for-each</strong>?
<p />
One's immediate approach might be to make a superclass that holds the
common functionality.  But let's make ourselves an artificial
restriction, just for the sake of playing things out: let's say that
we restrict ourselves from touching <strong>list%</strong> or *vector%*'s definition.
What then?
<p />
If we tie ourselves to this, then one approach might be to subclass:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
But this feels a little foolish.  Don't we hate code duplication?
<p />
<p />
Of course there's another approach.  Let's look at it:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
This is something very new if we're coming from Java, and probably
very surprising!  We're taking in a superclass, and "mixing in" a few
more methods to create a new class.  Now we don't have to repeat
ourselves, and things still work out:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
The real kicker here is that <strong>foreach-mixin</strong> can take in anything that
implements a <strong>fold</strong>, and spit out a new class that also implements a
<strong>for-each</strong> method.
<p />
<p />
Of course, the mixin depends on <strong>fold</strong>: it would also be silly to
apply this on people, but if we try it out:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
... we don't get an error!  It just means we have a <strong>valley-person2%</strong>
that is bogus.  Can we do better?
<p />
<p />
Let's fix this and restrict the mixing to superclasses that provide
<strong>fold</strong>, by using the <strong>inherit</strong> form again from the previous section:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
With this version, we'll catch errors a little more quickly:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Mixins provide us a robust mechanism for adding functionality in a
general way, and they're used quite a bit in <a href="/Cookbook/DrScheme">DrScheme</a>'s internals.
<p />
We can do even better if we use interfaces, which haven't been covered yet.  [fixme: but they should!]
<p />
<p />
<p />
<p />
<h2>
  <a name="Other_Resources"> Other Resources </a>
</h2>
<hr>
<p />
There's much more to the class system than what's covered here.  The
paper below is an excellent guide to the features that set (lib
"class.ss") far apart: D. S. Goldberg, R. B. Findler, and M. Flatt.
Super and Inner --- Together at Last!
(<a href="http://library.readscheme.org/page4.html" target="_top">http://library.readscheme.org/page4.html</a>)
<p />
<p />
More recently, <a href="http://people.cs.uchicago.edu/~robby/pubs/papers/aplas2006-fff.pdf" target="_top">Scheme with Classes, Mixins, and Traits</a> provides an excellent overview of the system.
<p />
<p />
Also, the Schematics Cookbook has notes on how to do OOP programming
for Scheme in general.  See <a href="/Cookbook/IdiomObjectOrientedProgramming">IdiomObjectOrientedProgramming</a> for more details.
<p />
<p />
There's a brief example of mixins in:
Modular Object-Oriented Programming with Units and Mixins
<a href="http://www.cs.utah.edu/plt/publications/icfp98-ff/" target="_top">http://www.cs.utah.edu/plt/publications/icfp98-ff/</a>
<p />
The paper Classes and Mixins give further examples of mixin-based programming
Classes and Mixins
<a href="http://www.cs.brown.edu/~sk/Publications/Papers/Published/fkf-classes-mixins/" target="_top">http://www.cs.brown.edu/~sk/Publications/Papers/Published/fkf-classes-mixins/</a>
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
I wonder if anyone has figured out how to do default arguments yet? I can't figure it out from the official docs.
<p />
-- <a href="/Main/HaraldKorneliussen">HaraldKorneliussen</a> - 11 Aug 2006
<p />
Done; added a small recipe about this here: <a href="/Cookbook/DefaultArgumentsClassInitialization">DefaultArgumentsClassInitialization</a>
<p />
-- <a href="/Main/DannyYoo">DannyYoo</a> - 4 Sep 2006
<p />
''Singleton Design Pattern using class.ss,''
<p />
Matthias was kind enough to reply to my query to the list with the following:
<p />
<p />
&gt; <cite>  One of the things you can do is instantiate a class once and export </cite><br>
only that instance:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
&gt; <cite>  Inside the class you never use new; instead you refer to this </cite><br>
instance.
<p />
-- <a href="/Main/StephenDeGabrielle">StephenDeGabrielle</a> - 12 Dec 2007
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/DannyYoo">DannyYoo</a> - 19 Apr 2006
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/GettingStartedRecipes">GettingStartedRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left">  </td>
</tr>
</table>
<p />
 </div>
</div>
