<div id="contentbox">
 <div class="widget">
 <h2>
  <a name="Implementing_parallel_or_using_t"> Implementing <code>parallel-or</code> using threads </a>
</h2>
<p />
<div class="scheme">
  <pre><span class="comment">; parallel-or : thunk thunk -&gt; value
</span><span class="comment">;   evaluate thunk1 and thunk2 in parallel,
</span><span class="comment">;   return the return value from the first thunk
</span><span class="comment">;   to end its evaluation and stop evaluation of the
</span><span class="comment">;   other thread.
</span>(<span class="keyword">define</span> (<span class="variable">parallel-or</span> <span class="variable">thunk1</span> <span class="variable">thunk2</span>)
  (<span class="keyword">let*</span> ([<span class="variable">result1</span> <span class="selfeval">#f</span>]
         [<span class="variable">result2</span> <span class="selfeval">#f</span>]
         [<span class="variable">thread1</span> (<span class="variable">thread</span> (<span class="keyword">lambda</span> () (<span class="keyword">set!</span> <span class="variable">result1</span> (<span class="variable">thunk1</span>))))]
         [<span class="variable">thread2</span> (<span class="variable">thread</span> (<span class="keyword">lambda</span> () (<span class="keyword">set!</span> <span class="variable">result2</span> (<span class="variable">thunk2</span>))))]
         [<span class="variable">finished-thread</span> (<span class="variable">object-wait-multiple</span> <span class="selfeval">#f</span> <span class="variable">thread1</span> <span class="variable">thread2</span>)])
    (<span class="keyword">cond</span>
      [(<span class="builtin">eq?</span> <span class="variable">finished-thread</span> <span class="variable">thread1</span>) (<span class="variable">kill-thread</span> <span class="variable">thread2</span>)
                                     <span class="variable">result1</span>]
      [<span class="keyword">else</span>                          (<span class="variable">kill-thread</span> <span class="variable">thread1</span>)
                                     <span class="variable">result2</span>])))
</pre>
</div>
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">infinite-loop</span>) (<span class="variable">infinite-loop</span>))
(<span class="variable">parallel-or</span> (<span class="keyword">lambda</span> () (<span class="variable">infinite-loop</span>))
             (<span class="keyword">lambda</span> () (<span class="variable">sleep</span> <span class="selfeval">3</span>) <span class="selfeval">41</span>))
(<span class="variable">parallel-or</span> (<span class="keyword">lambda</span> () (<span class="variable">sleep</span> <span class="selfeval">3</span>) <span class="selfeval">42</span>)
             (<span class="keyword">lambda</span> () (<span class="variable">infinite-loop</span>)))
</pre>
</div>
<p />
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 02 May 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/ThreadRecipes">ThreadRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 020 </td>
</tr>
</table>
<p />
 </div>
</div>
