<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Comparing_Floating_Point_Numbers"> Comparing Floating-Point Numbers  </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You want to compare two floating-point numbers and know if they are equal.  Unfortunately, floating-point arithmetic is not precise so very few results will match exactly.  Consequently, we usually want to compare floating point values up to a certain number of decimal places.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
Most Scheme implementations conforming to R5RS will implement the full tower of numerics, providing access to exact and inexact integers,
bignum support, and a raft of other tools making this particular
recipe somewhat unnecessary.
<p />
However, there are still cases where you want a "fuzzy match" on two real numbers since the difference is below some <code>epsilon</code> threshhold.
<p />
In these cases, you can use floating-point byte strings to represent and compare numbers:
<p />
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">a</span> (<span class="builtin">*</span> <span class="selfeval">8.001e-3</span> <span class="selfeval">9.001e5</span>))
<span class="builtin">&gt;</span> <span class="variable">a</span>
<span class="selfeval">7201.700099999999</span>
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">b</span> (<span class="builtin">*</span> <span class="selfeval">8.0011e-3</span> <span class="selfeval">9.001e5</span>))
<span class="builtin">&gt;</span> <span class="variable">b</span>
<span class="selfeval">7201.790110000001</span>
<span class="builtin">&gt;</span> (<span class="builtin">equal?</span> <span class="variable">a</span> <span class="variable">b</span>)
<span class="selfeval">#f</span>
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">ae</span> (<span class="variable">real-&gt;floating-point-byte-string</span> <span class="variable">a</span> <span class="selfeval">4</span>))
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">be</span> (<span class="variable">real-&gt;floating-point-byte-string</span> <span class="variable">b</span> <span class="selfeval">4</span>))
<span class="builtin">&gt;</span> (<span class="builtin">equal?</span> <span class="variable">ae</span> <span class="variable">be</span>)
<span class="selfeval">#t</span>
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">ae8</span> (<span class="variable">real-&gt;floating-point-byte-string</span> <span class="variable">a</span> <span class="selfeval">8</span>))
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">be8</span> (<span class="variable">real-&gt;floating-point-byte-string</span> <span class="variable">b</span> <span class="selfeval">8</span>))
<span class="builtin">&gt;</span> (<span class="builtin">equal?</span> <span class="variable">ae8</span> <span class="variable">be8</span>)
<span class="selfeval">#f</span>
</pre>
</div>
<p />
Another option is to convert the numbers into strings and then compare
the portions of the numbers of interest:
<p />
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">nsa</span> (<span class="builtin">number-&gt;string</span> <span class="variable">a</span>))
<span class="builtin">&gt;</span> <span class="variable">nsa</span>
<span class="selfeval">"7201.700099999999"</span>
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">nsb</span> (<span class="builtin">number-&gt;string</span> <span class="variable">b</span>))
<span class="builtin">&gt;</span> <span class="variable">nsb</span>
<span class="selfeval">"7201.7001009001"</span>
<span class="builtin">&gt;</span> (<span class="builtin">equal?</span> (<span class="builtin">substring</span> <span class="variable">nsa</span> <span class="selfeval">0</span> <span class="selfeval">6</span>) (<span class="builtin">substring</span> <span class="variable">nsb</span> <span class="selfeval">0</span> <span class="selfeval">6</span>))
<span class="selfeval">#t</span>
<span class="builtin">&gt;</span>
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
It is obviously better to make use of Scheme's bignum and exact
integer facilities to carry calculations through your programs with
the highest level of precision.  However, there are frequent cases
where it is useful to provide "fuzzy" matching on numerical terms.
Hopefully this recipe can help deal with those situations.
<p />
A final thought:
<p />
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">define</span> (<span class="variable">equal-to-digit</span> <span class="variable">digit</span> <span class="variable">numa</span> <span class="variable">numb</span>)
    (<span class="keyword">let</span> ((<span class="variable">nsa</span> (<span class="builtin">number-&gt;string</span> <span class="variable">numa</span>))
          (<span class="variable">nsb</span> (<span class="builtin">number-&gt;string</span> <span class="variable">numb</span>)))
      (<span class="builtin">equal?</span> (<span class="builtin">substring</span> <span class="variable">nsa</span> <span class="selfeval">0</span> <span class="variable">digit</span>) (<span class="builtin">substring</span> <span class="variable">nsb</span> <span class="selfeval">0</span> <span class="variable">digit</span>))))
<span class="builtin">&gt;</span> (<span class="variable">equal-to-digit</span> <span class="selfeval">6</span> <span class="variable">a</span> <span class="variable">b</span>)
<span class="selfeval">#t</span>
</pre>
</div>
<p />
Note:  Some error handling would obviously be necessary to handle
cases where the digits are insufficient for the match.
<p />
<p />
<h3>
  <a name="See_Also"> See Also </a>
</h3>
<p />
Volume 2, Section 4.2.2 of The Art of Computer Programming
<p />
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/NumberRecipes">NumberRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 020 </td>
</tr>
</table>
<p />
 </div>
</div>
