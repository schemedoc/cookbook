<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Gray_Codes"> Gray Codes </a>
</h2>
<p />
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
A Binary Gray Code of k bits is a rearrangement of the list of the numbers 0 up to but not including 2<sup>k</sup> such that every element differs in presicely one bit from the preceeding element. For example (#b000 #b001 #b011 #b010 #b110 #b111 #b101 #b100). The leading zero's must not be omitted. A Decimal Gray Code of k decimal figures is a rearrangement of the list of the numbers 0 up to but not including 10<sup>k</sup> such that every next element differs in only one decimal figure from the preceeding element. In general an (n,k) Gray code is a rearrangement of the list of the numbers 0 up to but not including n<sup>k</sup> such that the base n representation of each element differs in exactly one position from the base n representation of the next element.
<p />
How to make a Gray Code Table?
How to find the m<sup>th</sup> element of a Gray code?
How to find m given the m<sup>th</sup> element of a Gray Code?
<p />
For every n&gt;1 and k&gt;0 more than one Gray Code exists. The Gray Codes produced by procedures shown below have the property that going from left to right through the list, each digit switches more frequently than all more significant digits and that each digit passes the values 0, 1, ... n-1, n-1, n-2, ... 0, except for the most significant digit, which runs from 0 to n-1.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
<div class="scheme">
  <pre> (<span class="keyword">define-syntax</span> <span class="variable">while</span>
  (<span class="keyword">syntax-rules</span> ()
   ((<span class="variable">while</span> <span class="variable">test</span> <span class="variable">body</span> ...)
    (<span class="keyword">let</span> <span class="variable">loop</span> () (<span class="keyword">if</span> <span class="variable">test</span> (<span class="keyword">begin</span> <span class="variable">body</span> ... (<span class="variable">loop</span>)))))))
 (<span class="keyword">define</span> (<span class="variable">gray-code</span> <span class="variable">n</span> <span class="variable">k</span>) <span class="comment">;--&gt; (n k) gray code
</span>  (<span class="keyword">define</span> <span class="variable">g</span> (<span class="builtin">make-vector</span> <span class="variable">k</span> <span class="selfeval">0</span>))
  (<span class="keyword">define</span> <span class="variable">u</span> (<span class="builtin">make-vector</span> <span class="variable">k</span> <span class="selfeval">1</span>))
  (<span class="builtin">cons</span> (<span class="builtin">vector-&gt;list</span> <span class="variable">g</span>)
   (<span class="keyword">let</span> <span class="variable">loop</span> ()
    (<span class="variable">let/ec</span> <span class="variable">ec</span>
     (<span class="keyword">let</span> ((<span class="variable">i</span> <span class="selfeval">0</span>) (<span class="variable">j</span> (<span class="builtin">+</span> (<span class="builtin">vector-ref</span> <span class="variable">g</span> <span class="selfeval">0</span>) (<span class="builtin">vector-ref</span> <span class="variable">u</span> <span class="selfeval">0</span>))))
      (<span class="variable">while</span> (<span class="keyword">or</span> (<span class="builtin">&gt;=</span> <span class="variable">j</span> <span class="variable">n</span>) (<span class="builtin">&lt;</span> <span class="variable">j</span> <span class="selfeval">0</span>))
       (<span class="builtin">vector-set!</span> <span class="variable">u</span> <span class="variable">i</span> (<span class="builtin">-</span> (<span class="builtin">vector-ref</span> <span class="variable">u</span> <span class="variable">i</span>)))
       (<span class="keyword">set!</span> <span class="variable">i</span> (<span class="variable">add1</span> <span class="variable">i</span>))
       (<span class="keyword">if</span> (<span class="builtin">&gt;=</span> <span class="variable">i</span> <span class="variable">k</span>) (<span class="variable">ec</span> ()))
       (<span class="keyword">set!</span> <span class="variable">j</span> (<span class="builtin">+</span> (<span class="builtin">vector-ref</span> <span class="variable">g</span> <span class="variable">i</span>) (<span class="builtin">vector-ref</span> <span class="variable">u</span> <span class="variable">i</span>))))
      (<span class="builtin">vector-set!</span> <span class="variable">g</span> <span class="variable">i</span> <span class="variable">j</span>)
      (<span class="builtin">cons</span> (<span class="builtin">reverse</span> (<span class="builtin">vector-&gt;list</span> <span class="variable">g</span>)) (<span class="variable">loop</span>)))))))
 <span class="comment">; For example:
</span>
 (<span class="builtin">write</span> (<span class="variable">gray-code</span> <span class="selfeval">4</span> <span class="selfeval">3</span>)) <span class="comment">;--&gt;
</span> ((<span class="selfeval">0</span> <span class="selfeval">0</span> <span class="selfeval">0</span>) (<span class="selfeval">0</span> <span class="selfeval">0</span> <span class="selfeval">1</span>) (<span class="selfeval">0</span> <span class="selfeval">0</span> <span class="selfeval">2</span>) (<span class="selfeval">0</span> <span class="selfeval">0</span> <span class="selfeval">3</span>) (<span class="selfeval">0</span> <span class="selfeval">1</span> <span class="selfeval">3</span>) (<span class="selfeval">0</span> <span class="selfeval">1</span> <span class="selfeval">2</span>) (<span class="selfeval">0</span> <span class="selfeval">1</span> <span class="selfeval">1</span>) (<span class="selfeval">0</span> <span class="selfeval">1</span> <span class="selfeval">0</span>)
  (<span class="selfeval">0</span> <span class="selfeval">2</span> <span class="selfeval">0</span>) (<span class="selfeval">0</span> <span class="selfeval">2</span> <span class="selfeval">1</span>) (<span class="selfeval">0</span> <span class="selfeval">2</span> <span class="selfeval">2</span>) (<span class="selfeval">0</span> <span class="selfeval">2</span> <span class="selfeval">3</span>) (<span class="selfeval">0</span> <span class="selfeval">3</span> <span class="selfeval">3</span>) (<span class="selfeval">0</span> <span class="selfeval">3</span> <span class="selfeval">2</span>) (<span class="selfeval">0</span> <span class="selfeval">3</span> <span class="selfeval">1</span>) (<span class="selfeval">0</span> <span class="selfeval">3</span> <span class="selfeval">0</span>)
  (<span class="selfeval">1</span> <span class="selfeval">3</span> <span class="selfeval">0</span>) (<span class="selfeval">1</span> <span class="selfeval">3</span> <span class="selfeval">1</span>) (<span class="selfeval">1</span> <span class="selfeval">3</span> <span class="selfeval">2</span>) (<span class="selfeval">1</span> <span class="selfeval">3</span> <span class="selfeval">3</span>) (<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">3</span>) (<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">2</span>) (<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">1</span>) (<span class="selfeval">1</span> <span class="selfeval">2</span> <span class="selfeval">0</span>)
  (<span class="selfeval">1</span> <span class="selfeval">1</span> <span class="selfeval">0</span>) (<span class="selfeval">1</span> <span class="selfeval">1</span> <span class="selfeval">1</span>) (<span class="selfeval">1</span> <span class="selfeval">1</span> <span class="selfeval">2</span>) (<span class="selfeval">1</span> <span class="selfeval">1</span> <span class="selfeval">3</span>) (<span class="selfeval">1</span> <span class="selfeval">0</span> <span class="selfeval">3</span>) (<span class="selfeval">1</span> <span class="selfeval">0</span> <span class="selfeval">2</span>) (<span class="selfeval">1</span> <span class="selfeval">0</span> <span class="selfeval">1</span>) (<span class="selfeval">1</span> <span class="selfeval">0</span> <span class="selfeval">0</span>)
  (<span class="selfeval">2</span> <span class="selfeval">0</span> <span class="selfeval">0</span>) (<span class="selfeval">2</span> <span class="selfeval">0</span> <span class="selfeval">1</span>) (<span class="selfeval">2</span> <span class="selfeval">0</span> <span class="selfeval">2</span>) (<span class="selfeval">2</span> <span class="selfeval">0</span> <span class="selfeval">3</span>) (<span class="selfeval">2</span> <span class="selfeval">1</span> <span class="selfeval">3</span>) (<span class="selfeval">2</span> <span class="selfeval">1</span> <span class="selfeval">2</span>) (<span class="selfeval">2</span> <span class="selfeval">1</span> <span class="selfeval">1</span>) (<span class="selfeval">2</span> <span class="selfeval">1</span> <span class="selfeval">0</span>)
  (<span class="selfeval">2</span> <span class="selfeval">2</span> <span class="selfeval">0</span>) (<span class="selfeval">2</span> <span class="selfeval">2</span> <span class="selfeval">1</span>) (<span class="selfeval">2</span> <span class="selfeval">2</span> <span class="selfeval">2</span>) (<span class="selfeval">2</span> <span class="selfeval">2</span> <span class="selfeval">3</span>) (<span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">3</span>) (<span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">2</span>) (<span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">1</span>) (<span class="selfeval">2</span> <span class="selfeval">3</span> <span class="selfeval">0</span>)
  (<span class="selfeval">3</span> <span class="selfeval">3</span> <span class="selfeval">0</span>) (<span class="selfeval">3</span> <span class="selfeval">3</span> <span class="selfeval">1</span>) (<span class="selfeval">3</span> <span class="selfeval">3</span> <span class="selfeval">2</span>) (<span class="selfeval">3</span> <span class="selfeval">3</span> <span class="selfeval">3</span>) (<span class="selfeval">3</span> <span class="selfeval">2</span> <span class="selfeval">3</span>) (<span class="selfeval">3</span> <span class="selfeval">2</span> <span class="selfeval">2</span>) (<span class="selfeval">3</span> <span class="selfeval">2</span> <span class="selfeval">1</span>) (<span class="selfeval">3</span> <span class="selfeval">2</span> <span class="selfeval">0</span>)
  (<span class="selfeval">3</span> <span class="selfeval">1</span> <span class="selfeval">0</span>) (<span class="selfeval">3</span> <span class="selfeval">1</span> <span class="selfeval">1</span>) (<span class="selfeval">3</span> <span class="selfeval">1</span> <span class="selfeval">2</span>) (<span class="selfeval">3</span> <span class="selfeval">1</span> <span class="selfeval">3</span>) (<span class="selfeval">3</span> <span class="selfeval">0</span> <span class="selfeval">3</span>) (<span class="selfeval">3</span> <span class="selfeval">0</span> <span class="selfeval">2</span>) (<span class="selfeval">3</span> <span class="selfeval">0</span> <span class="selfeval">1</span>) (<span class="selfeval">3</span> <span class="selfeval">0</span> <span class="selfeval">0</span>))
 (<span class="keyword">define</span> (<span class="variable">number-&gt;gray-code</span> <span class="variable">m</span> <span class="variable">n</span> <span class="variable">k</span>) <span class="comment">; m n k --&gt; m-th element of (n,k) gray code
</span>  (<span class="keyword">let</span> ((<span class="variable">2n</span> (<span class="builtin">*</span> <span class="selfeval">2</span> <span class="variable">n</span>)))
   (<span class="keyword">let</span> <span class="variable">loop</span> ((<span class="variable">m</span> <span class="variable">m</span>) (<span class="variable">k</span> <span class="variable">k</span>) (<span class="variable">gc</span> ()))
    (<span class="keyword">if</span> (<span class="builtin">zero?</span> <span class="variable">k</span>) <span class="variable">gc</span>
     (<span class="keyword">let</span> ((<span class="variable">q</span> (<span class="builtin">quotient</span> <span class="variable">m</span> <span class="variable">n</span>)) (<span class="variable">r</span> (<span class="builtin">modulo</span> <span class="variable">m</span> <span class="variable">2n</span>)))
      (<span class="variable">loop</span> <span class="variable">q</span> (<span class="variable">sub1</span> <span class="variable">k</span>) (<span class="builtin">cons</span> (<span class="keyword">if</span> (<span class="builtin">&gt;=</span> <span class="variable">r</span> <span class="variable">n</span>) (<span class="builtin">-</span> <span class="variable">2n</span> <span class="variable">r</span> <span class="selfeval">1</span>) <span class="variable">r</span>) <span class="variable">gc</span>)))))))
 <span class="comment">; With its inverse:
</span>
 (<span class="keyword">define</span> (<span class="variable">gray-code-&gt;number</span> <span class="variable">gc</span> <span class="variable">n</span>) <span class="comment">; m-th (n,k) gray-code --&gt; m
</span>  (<span class="keyword">let</span> <span class="variable">loop</span> ((<span class="variable">gc</span> <span class="variable">gc</span>) (<span class="variable">significance</span> (<span class="builtin">expt</span> <span class="variable">n</span> (<span class="variable">sub1</span> (<span class="builtin">length</span> <span class="variable">gc</span>)))))
   (<span class="keyword">if</span> (<span class="builtin">null?</span> <span class="variable">gc</span>) <span class="selfeval">0</span>
    (<span class="keyword">let</span> ((<span class="variable">digit</span> (<span class="builtin">car</span> <span class="variable">gc</span>)) (<span class="variable">gc</span> (<span class="builtin">cdr</span> <span class="variable">gc</span>)))
     (<span class="keyword">let</span> ((<span class="variable">m</span> (<span class="variable">loop</span> <span class="variable">gc</span> (<span class="builtin">quotient</span> <span class="variable">significance</span> <span class="variable">n</span>))))
      (<span class="builtin">+</span> (<span class="builtin">*</span> <span class="variable">digit</span> <span class="variable">significance</span>)
       (<span class="keyword">if</span> (<span class="builtin">odd?</span> <span class="variable">digit</span>) (<span class="builtin">-</span> <span class="variable">significance</span> <span class="variable">m</span> <span class="selfeval">1</span>) <span class="variable">m</span>)))))))
 (<span class="variable">number-&gt;gray-code</span> <span class="selfeval">10</span> <span class="selfeval">4</span> <span class="selfeval">3</span>)     <span class="comment">;--&gt; (0 2 2)
</span> (<span class="variable">gray-code-&gt;number</span> <span class="keyword">'</span>(<span class="selfeval">0</span> <span class="selfeval">2</span> <span class="selfeval">2</span>) <span class="selfeval">4</span>) <span class="comment">;--&gt; 10
</span></pre>
</div>
<p />
<h3>
  <a name="Application"> Application </a>
</h3>
<p />
For readers familiar with the Tower of Hanoi: <code>(gray-code 3 h)</code> shows how to move a Tower of h disks from peg 0 to peg 2 passing every other feasible distribition of disks exactly once (Hamilton path)
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
<p />
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/JosKoot">JosKoot</a> - 24 Nov 2006
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/NumberRecipes">NumberRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
