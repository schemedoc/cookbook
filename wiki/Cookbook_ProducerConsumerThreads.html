<div id="contentbox">
 <div class="widget">
 <h2>
  <a name="Consumer_Producer_Threads"> Consumer/Producer Threads </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
Some problems can be conveniently solved using a consumer/producer model. A <code>producer</code> generates data, which a <code>consumer</code> must handle.
Special care must be taken to handle the situation where the <code>producer</code> generates data faster than the <code>consumer</code> can handle. In this case, the values must be queued until the <code>consumer</code> is ready.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
The <code>thread.ss</code> collection provides a solution in the form of the <code>consumer-thread</code> function. The <code>consumer-thread</code> function receives a function <code>f</code> capable of handling one piece of data, and returns two values: a thread in which the consumer runs, and a function which the producer (the current thread) can use to send data to the consumer. The function will queue the data and return void immediately.
<p />
In the example below, the consumer uses two seconds to print each number, whereas the consumer generates the numbers instantaneously. The numbers are printed with delay of two seconds between.
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">let-values</span> ([(<span class="variable">thread</span> <span class="variable">consumer</span>)
                (<span class="variable">consumer-thread</span> (<span class="keyword">lambda</span> (<span class="variable">n</span>)
                                   (<span class="variable">sleep</span> <span class="selfeval">2</span>)
                                   (<span class="builtin">display</span> (<span class="builtin">*</span> <span class="variable">n</span> <span class="variable">n</span>))
                                   (<span class="builtin">newline</span>)))])
    (<span class="variable">consumer</span> <span class="selfeval">1</span>)
    (<span class="variable">consumer</span> <span class="selfeval">2</span>)
    (<span class="variable">consumer</span> <span class="selfeval">3</span>))
<span class="builtin">&gt;</span>
<span class="selfeval">1</span>
<span class="selfeval">4</span>
<span class="selfeval">9</span>
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
The <code>consumer-thread</code> has an optional parameter <code>init</code>, a <a href="/Cookbook/Thunk">thunk</a> which if present is called as the first thing in the new (consumer) thread.
<p />
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 02 May 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/ThreadRecipes">ThreadRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 030 </td>
</tr>
</table>
<p />
 </div>
</div>
