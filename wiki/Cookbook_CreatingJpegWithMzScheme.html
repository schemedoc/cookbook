<div id="contentbox">
 <div class="widget">
  <p />
<h2><a name="Creating_Jpeg_from_scratch_using"> </a> Creating Jpeg from scratch using <a href="/Cookbook/MzScheme">MzScheme</a> </h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
<p />
You are using PLT <a href="/Cookbook/DrScheme">DrScheme</a> and you want to draw graphs, generate graphics, or process images from scratch and write out a jpeg.
<p />
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
<a href="/Cookbook/MrEd">MrEd</a>, a part of <a href="/Cookbook/MzScheme">MzScheme</a> gives you functions for opening image files, writing images to disk, and for drawing on images once you have a device context.
<p />
Let's draw a 255 pixel by 255 pixel color gradient.
<p />
<div class="scheme">
  <pre>(<span class="keyword">let</span> ((<span class="variable">bitmap</span> (<span class="variable">make-object</span> <span class="variable">bitmap%</span> <span class="selfeval">255</span> <span class="selfeval">255</span>))
      (<span class="variable">dc</span> (<span class="variable">make-object</span> <span class="variable">bitmap-dc%</span>))
      (<span class="variable">red-amount</span> <span class="selfeval">150</span>)
      (<span class="variable">image-file</span> <span class="selfeval">"/tmp/foo.jpg"</span>))
  (<span class="variable">send</span> <span class="variable">dc</span> <span class="variable">set-bitmap</span> <span class="variable">bitmap</span>)
  (<span class="keyword">do</span> ((<span class="variable">x</span> <span class="selfeval">0</span> (<span class="builtin">+</span> <span class="variable">x</span> <span class="selfeval">1</span>)))
    ((<span class="builtin">&gt;=</span> <span class="variable">x</span> <span class="selfeval">255</span>))
    (<span class="keyword">do</span> ((<span class="variable">y</span> <span class="selfeval">0</span> (<span class="builtin">+</span> <span class="variable">y</span> <span class="selfeval">1</span>)))
      ((<span class="builtin">&gt;=</span> <span class="variable">y</span> <span class="selfeval">255</span>))
      (<span class="variable">send</span> <span class="variable">dc</span> <span class="variable">set-pixel</span> <span class="variable">x</span> <span class="variable">y</span>
            (<span class="variable">make-object</span> <span class="variable">color%</span> <span class="variable">red-amount</span> <span class="variable">x</span> <span class="variable">y</span>))))
  (<span class="keyword">when</span> (<span class="variable">file-exists?</span> <span class="variable">image-file</span>)
      (<span class="variable">delete-file</span> <span class="variable">image-file</span>))
  (<span class="variable">send</span> <span class="variable">bitmap</span> <span class="variable">save-file</span> <span class="variable">image-file</span> <span class="keyword">'</span><span class="variable">jpeg</span> <span class="selfeval">100</span>))
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
<img src="/twiki/pub/Cookbook/CreatingJpegWithMzScheme/foo.jpg" alt="foo.jpg" width="255" height="255" style="float:right; margin-left: 5px">
<p />
The code above when run, creates a jpg on you hard drive which is a color gradation where red is constantly 150 for all values and the green and blue vary from 0 to 254 across the image.
<p />
First we make a bitmap and a bitmap-dc. A bitmap-dc is a "device context" which allows us to draw into this new bitmap. We then connect them with the 'set-bitmap' message. We create a value for red 150 and an image path that should be legal for our computer. Windows users may need to change this to 'C:\Temp' etc.
<p />
We have two loops from 0 to 254 by increments of 1. This is our x and y, so that we can iterate across the bitmap. A color's value is made up of three componetnts - red, blue, and green. The values for each part can be from 0 to 254.
<p />
The point of our exercise is to send the 'dc' object messages such as 'set-pixel', so that can draw into the bitmap. The documentation for bitmap-dc% in PLT <a href="/Cookbook/MrEd">MrEd</a> Graphical Toolbox Manual describes all of the other drawing operations you can do, including drawing shapes and copying portions from other images into your bitmap.
<p />
Next we check if the image file exists, and if it does we delete it. And lastly we save the bitmap out in jpeg format at 100% quality. <a href="/Cookbook/MzScheme">MzScheme</a> can read and write the jpeg format.
<p />
You can now open the file in an image viewer. Change the loop and experiment. Try using (random 255) when making a color.
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/AustinKing">AustinKing</a> - 29 Sep 2007
<p />
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> GUIRecipes </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
  <p />
<table border="1" cellspacing="0" cellpadding="1"> <tr>
  <th align="center" bgcolor="#99CCCC"> <strong><a href="/TWiki/FileAttachment">Attachment</a>:</strong> </th>
  <th align="center" bgcolor="#99CCCC"> <strong>Action:</strong> </th>
  <th align="center" bgcolor="#99CCCC"> <strong>Size:</strong> </th>
  <th align="center" bgcolor="#99CCCC"> <strong>Date:</strong> </th>
  <th align="center" bgcolor="#99CCCC"> <strong>Who:</strong> </th>
  <th align="center" bgcolor="#99CCCC"> <strong>Comment:</strong> </th>
</tr>
<tr>
  <td>  <img src="/twiki/pub/icn/bmp.gif" width="16" height="16" align="top" alt=""> <a href="/twiki/pub/Cookbook/CreatingJpegWithMzScheme/foo.jpg">foo.jpg</a>     </td>
  <td>  <a href="http://schemecookbook.org/attach/Cookbook/CreatingJpegWithMzScheme?filename=foo.jpg&amp;amp;revInfo=1">action</a>     </td>
  <td>  16807  </td>
  <td>  29 Sep 2007 - 17:56  </td>
  <td>  <a href="/Main/AustinKing">AustinKing</a>  </td>
  <td>  Our Blue - Green Gradient where red is constant  </td>
</tr>
</table>
<p />
 </div>
</div>
