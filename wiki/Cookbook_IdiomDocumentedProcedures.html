<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Accessing_Procedure_Source_Code"> Accessing Procedure Source Code </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
<span style="background : #FFFFCE;">
  <font color="#0000FF">JavaScript</font>
</span><a href="/edit/Cookbook/JavaScript?topicparent=Cookbook.IdiomDocumentedProcedures">?</a> programmers are familiar with accessing the source code of a procedure at runtime. Can we do this in Scheme?
<p />
We would also like to store other meta-information about a procedure, say, to provide a documentation string for the procedure, similar to Emacs Lisp doc-strings.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
The answer is a qualified "yes," <em>if you really want to</em>, provided that the procedure is created with a special form described here. But see the caveat below for a discussion of the dangers of exposing procedure source code.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
The <code>doc-lambda</code> macro turns its source code into an S-expression by quoting it and storing it in a struct. It creates the actual procedure and stores that in the struct as well, along with the provided documentation string.
<p />
The struct is executable as a procedure thanks to <a href="/Cookbook/MzScheme">MzScheme</a>'s "structs as procedures" (see chapter 4.6 in the <a href="/Cookbook/MzScheme">MzScheme</a> language manual): the final argument to <code>make-struct-type</code> tells <a href="/Cookbook/MzScheme">MzScheme</a> to treat the 0th item in the struct as the procedure to invoke when the struct is applied as a procedure.
<p />
<h3>
  <a name="Caveat"> Caveat </a>
</h3>
<p />
Exposing a function's source code might be useful for debugging, for example, where a quick view of the code can help you discover the source of a bug. But generally, this can lead to dependencies on the internal implementation of a procedure. If external code relies on the procedure's source code, changing the implementation of the procedure breaks the external code.
<p />
If all you want is a way to represent a procedure as data that can be stored and reinvoked later, simply store and invoke the closure directly. Don't use this recipe simply to call <code>eval</code> on procedure source. (In addition to the many evils of <code>eval</code>, that approach will likely break if the procedure source refers to variables in scope other than just the procedure arguments.)
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
For newcomers it might be worth noting this recipe is about "it can be done if you <strong>really</strong> want to" rather than "this approach is recommended".
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 16 May 2006
<p />
Good point. I've added the caveat section.
<p />
-- <a href="/Main/DaveHerman">DaveHerman</a> - 16 May 2006
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/DaveHerman">DaveHerman</a> - 16 May 2006
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/IdiomRecipes">IdiomRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
