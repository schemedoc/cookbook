<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Serialize_Data_to_File"> Serialize Data to File </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You want to <code>write</code> data to a file such that when you <code>eval</code> that file that data is recreated.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
Use the functions provided by the <code>pconvert</code> library to convert data into a format, that when read, will recreate the data.  For example, the <code>print-convert</code> function converts data to quasi-quoted form:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
You might wonder we don't just use <code>write</code> and <code>read</code> instead of <code>print-convert</code>.  There are two reasons for this.  Firstly, the range of data that can be represented by <code>print-convert</code> is greater than that that can be represented by <code>write</code>.  See, for instance, <a href="/Cookbook/StructuresReadingAndWriting">StructuresReadingAndWriting</a> which discusses reading and writing structures using <code>print-convert</code>.
<p />
More importantly <code>print-convert=ed data can be intermingled with program code.&nbsp; For example, if we have the list ='(+ 1 2)</code> then if we <code>write</code> and <code>eval</code> this data we get the value <code>3</code>.  However if we first <code>print-convert</code> the data and then <code>eval</code> it we get the back the original list:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
This allows, for example, programmatic configuration files that are a mixture of code and print-converted data.  This idea is sometimes known as an <a href="http://www.doc.ic.ac.uk/~np2/patterns/scripting/data-as-code.html" target="_top">Active File</a>.  For example:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Two convenience functions to write and read (eval) files are:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
In use:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
Note that <code>load</code> can take the place of <code>read-converted</code> in most situations.  <code>Load</code> will <code>eval</code> all expressions in a file, while <code>read-converted</code> will only <code>eval</code> the first.   In this way <code>read-converted</code> is the mirror of <code>write-converted</code>, which only writes a single expression to a file.
<p />
To create human-readable output (for instance, in configuration files) the <code>pretty-print</code> function in the <code>pretty.ss</code> library comes in handy:
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
See <span style="background : #FFFFCE;">
  <font color="#0000FF">IdiomPrettyPrint</font>
</span><a href="/edit/Cookbook/IdiomPrettyPrint?topicparent=Cookbook.IdiomSerializeToFile">?</a> for more information.
<p />
Finally if using <code>eval</code> you should be careful that you protect your code and the user's computer against malicious code.  See <a href="/Cookbook/DynamicUntrustedEval">DynamicUntrustedEval</a> for information on how to do this.
<p />
<h3>
  <a name="See_Also"> See Also </a>
</h3>
<p />
A number of recipes are mentioned in the discussion:
<p />
<ul>
<li> <span style="background : #FFFFCE;">
  <font color="#0000FF">IdiomPrettyPrint</font>
</span><a href="/edit/Cookbook/IdiomPrettyPrint?topicparent=Cookbook.IdiomSerializeToFile">?</a>
</li>
<li> <a href="/Cookbook/DynamicUntrustedEval">DynamicUntrustedEval</a>
</li>
<li> <a href="/Cookbook/StructuresReadingAndWriting">StructuresReadingAndWriting</a>
</li>
</ul>
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
Integrated all the comments into the text.
<p />
-- <a href="/Main/NoelWelsh">NoelWelsh</a> - 23 Dec 2004
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/NoelWelsh">NoelWelsh</a>
<p />
-- <a href="/Main/DanielSilva">DanielSilva</a>
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a>
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/IdiomRecipes">IdiomRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
