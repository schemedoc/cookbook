<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Suspending_the_Current_Thread"> Suspending the Current Thread </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You wish to indefinitely suspend the current thread
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
There are two good solutions:
<p />
<div class="scheme">
  <pre>(<span class="variable">sync</span> (<span class="variable">make-semaphore</span>))
(<span class="variable">thread-wait</span> (<span class="variable">current-thread</span>))
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
Why would you ever want to suspend the current thread?  Say you are writing a server with the following architecture:  the main thread does some setup, creates some worker threads to handle requests, and then has nothing to do.  The main thread cannot exit, because <a href="/Cookbook/MzScheme">MzScheme</a> will exit if it does.  Hence it is necessary to suspend the current thread.
<p />
If there was only one worker thread, you could wait until it exited:
<p />
<div class="scheme">
  <pre>(<span class="variable">sync/enable-break</span> <span class="variable">worker-thread</span>)
</pre>
</div>
<p />
Notice the call to <code>sync/enable-break</code>, not <code>sync</code>.  Normally breaks are enabled, so this call is equivalent to just <code>sync</code>, but in case they aren't it is good practice to enable them, as it allows the main thread to be interrupted by Control-C.
<p />
Two idioms you shouldn't use are:
<p />
<div class="scheme">
  <pre>(<span class="keyword">let</span> <span class="variable">loop</span> () (<span class="variable">loop</span>))  <span class="comment">;; busy wait
</span>(<span class="variable">thread-suspend</span> (<span class="variable">current-thread</span>))
</pre>
</div>
<p />
The former is an infinite loop, which needlessly consumes CPU resources.  The later will stop the main thread handling break signals.  If all the worker threads exit without resuming the main thread <a href="/Cookbook/MzScheme">MzScheme</a> will complain with "unbreakable deadlock" and immediately exit.
<p />
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
NB: Based on advice supplied by <span style="background : #FFFFCE;">
  <font color="#0000FF">MatthewFlatt</font>
</span><a href="/edit/Cookbook/MatthewFlatt?topicparent=Cookbook.ThreadSuspendingCurrentThread">?</a> on the <a href="/Cookbook/PltScheme">PltScheme</a> mailing list 13/06/2006.
<p />
Hmm.  Why not wait on <em>all</em> the threads?  It seems your way, the program will never exit, unless one of the child threads actually calls "exit", which seems dangerous.
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/NoelWelsh">NoelWelsh</a> - 13 Jun 2006
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/ThreadRecipes">ThreadRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
