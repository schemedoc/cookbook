<div id="contentbox">
 <div class="widget">
 <h1>
  <a name="Cookbook_Structure_Proposal"> Cookbook Structure Proposal </a>
</h1>
<p />
<p />
<ul>
<li> <a href="/Cookbook/CookbookStructure#Cookbook_Structure_Proposal">Cookbook Structure Proposal</a>
<ul>
<li> <a href="/Cookbook/CookbookStructure#Note">Note</a>
</li>
<li> <a href="/Cookbook/CookbookStructure#Overview">Overview</a>
</li>
<li> <a href="/Cookbook/CookbookStructure#Example">Example</a>
</li>
<li> <a href="/Cookbook/CookbookStructure#Benefits">Benefits </a>
</li>
<li> <a href="/Cookbook/CookbookStructure#Explanation_of_Design_Features">Explanation of Design Features</a>
</li>
<li> <a href="/Cookbook/CookbookStructure#String_Recipes">String Recipes</a>
<ul>
<li> <a href="/Cookbook/CookbookStructure#Ordering_of_chapters_sections_an">Ordering of chapters, sections, and recipes.</a>
</li>
</ul>
</li>
<li> <a href="/Cookbook/CookbookStructure#Implementation_plan">Implementation plan</a>
</li>
</ul>
</li>
</ul>
<p />
<h2>
  <a name="Note"> Note </a>
</h2>
<p />
Below is the proposal for the new cookbook structure, written prior to implementation.  The technical details of the final design are described at <a href="/Cookbook/ChapterStructure">ChapterStructure</a>.  Although the proposal below provides more background information, the details in <a href="/Cookbook/ChapterStructure">ChapterStructure</a> supersede the details below.  The below will be updated and converted to documentation.  <a href="/Cookbook/SiteToDo">SiteToDo</a>.
<p />
<h2>
  <a name="Overview"> Overview </a>
</h2>
<p />
This proposal is a relatively minor extension to the existing approach.
<p />
The proposed change centers around the structure of chapters.  Currently, chapters are manually-edited topics.  This proposal would change that, to allow chapters to be auto-generated by a simple query, and to better support automatic generation of various high-level views of the cookbook, such as TOCs.
<p />
To achieve this, a chapter will be defined as consisting of a number of sections, i.e. separate topics with a <a href="/Cookbook/TopicType">TopicType</a> of <em>Section</em>.  Generation of a chapter will be achieved simply by appending its sections together using a query and the <code>%INCLUDE%</code> directive.  It will be required that chapter topics themselves are autogenerated, and contain no other content than the chapter title, and the query which includes its sections.
<p />
Requiring that chapters consist of sections which are stored in separate topics allows greater control over autogenerated views of the cookbook, and allows things to be done with TWiki searches that wouldn't otherwise work correctly.  It allows queries to choose whether they want to work with sections, or chapters, or both.  This is not possible if chapter topics are arbitrarily-constructed collections of content, such as a mix of headings at different levels and the use of <code>%TOC%</code> directives.
<p />
Note that a major factor driving the design of this proposal is, of course, the features and limitations of TWiki.  However, the proposal is a simple one which would not be inappropriate in other contexts, outside of TWiki, and the structural rules it imposes should aid in management of the cookbook.  It can be thought of as a kind of relational normalization of topic content: ensuring that content from different levels (chapters and sections) is not mixed.
<p />
<h2>
  <a name="Example"> Example </a>
</h2>
<p />
Examples of chapters which have been changed to work this way are <a href="/Cookbook/StringChapter">StringChapter</a> and <a href="/Cookbook/NumberChapter">NumberChapter</a> (follow the links to take a look).  The entire source to <a href="/Cookbook/StringChapter">StringChapter</a> now looks like this:
<p />
<pre>
%STARTINCLUDE%
---+ %URLPARAM{"title"}%
%TMPL:P{"chapterquery"}%
%STOPINCLUDE%
&lt;br /&gt;
---
%TMPL:P{"chaptercommentlink"}%
%INCLUDE{"%TOPIC%Comments"}%
   * Set ALLOWTOPICCHANGE = Main.SchematicsEditorsGroup
</pre>
<p />
(The previous manually-generated <a href="/Cookbook/StringChapter">StringChapter</a> topic can be found in <a href="/Cookbook/StringRecipesOld">StringRecipesOld</a>.)
<p />
<a href="/Cookbook/StringChapter">StringChapter</a> consists of four section topics, and a special "Comments" section, <a href="/Cookbook/StringChapterComments">StringChapterComments</a>.  The normal section topics are:
<p />
<ul>
<li> <a href="/Cookbook/StringIntroduction">StringIntroduction</a>
</li>
<li> <a href="/Cookbook/StringRecipes">StringRecipes</a>
</li>
<li> <a href="/Cookbook/StringOther">StringOther</a>
</li>
<li> <a href="/Cookbook/StringReference">StringReference</a>
</li>
</ul>
<p />
The query which generates the <a href="/Cookbook/StringChapter">StringChapter</a> page simply searches for all the Sections whose parent is the current chapter, and <code>%INCLUDE%s</code> them all into the chapter topic.  Contributors can add sections to a chapter at will, simply by setting <a href="/Cookbook/TopicType">TopicType</a> to Section and setting <a href="/Cookbook/ParentTopic">ParentTopic</a> accordingly.  This means that contributors only have to concern themselves with actual content, not with overall structure, other than classifying the topics they work on correctly.
<p />
A section can contain anything which makes sense when <code>%INCLUDE%d</code> at the chapter level.  Most chapters will have a recipe section.  The recipe section can also be automatically generated.  <a href="/Cookbook/StringRecipes">StringRecipes</a> is an example of this.  It is based on the following query:
<p />
<pre>
%SEARCH{"TopicType.*value=\"Recipe;ParentTopic.*value=\"%TOPIC%"
casesensitive="on" regex="on" nosearch="on" nototal="on" order="formfield(TopicOrder)"
format="%TMPL:P{"recipefmt"}%"}%
</pre>
<p />
<h2>
  <a name="Benefits"> Benefits  </a>
</h2>
<p />
Chapter topics will now be auto-generated, as will sections containing lists of recipes.  Various <a href="/Cookbook/TOC">TOC</a>-generating queries will become easier and produce better results.  Examples of this include the new <a href="/Cookbook/TOC">TOC</a> and <a href="/Cookbook/SectionIndex">SectionIndex</a>.  This should completely eliminate the need for a manually-edited TOC, like <a href="/Cookbook/OldTOC">OldTOC</a>.  Previous attempts at automating the <a href="/Cookbook/TOC">TOC</a> had various shortcomings.
<p />
In general, this proposal better supports multiple views of the cookbook.  Further explanation is provided in the following section.
<p />
<h2>
  <a name="Explanation_of_Design_Features"> Explanation of Design Features </a>
</h2>
<p />
The proposed approach addresses various problems which may not be immediately obvious.  Analyzing the structure of the <a href="/Cookbook/SectionIndex">SectionIndex</a> topic will help focus on the important aspects of this proposal.
<p />
The <a href="/Cookbook/SectionIndex">SectionIndex</a> topic provides a view of the cookbook in which each chapter has its own heading, rather than being bulleted items as in the case of <a href="/Cookbook/TOC">TOC</a> (automatically generated) or <a href="/Cookbook/OldTOC">OldTOC</a> (semi-manually created).  Although <a href="/Cookbook/SectionIndex">SectionIndex</a> doesn't currently appear in final form, since the underlying topics are not yet appropriately arranged, something similar to the desired effect can be seen in <a href="/Cookbook/RecipeIndex">RecipeIndex</a>.  <a href="/Cookbook/RecipeIndex">RecipeIndex</a>, however, simply provides a list of recipes for each chapter, and does not reflect any other structure of those chapters.
<p />
To achieve the effect desired for <a href="/Cookbook/SectionIndex">SectionIndex</a>, it uses a nested search query, which queries first for Chapters, and within each chapter, for Sections.  Each Section, in turn, has its contents formatted using the <code>%TOC%</code> directive.  This provides the ability to render chapter headings as major headings, while rendering section contents in TWiki's bulleted TOC format.
<p />
If section content - actual section headings and text - were directly present in a chapter topic, then using %TOC% to summarize this content would also include the chapter heading, which has to be present on the chapter topic.  In queries such as the one for <a href="/Cookbook/SectionIndex">SectionIndex</a> described above, this results in duplication of the chapter title, e.g.:
<p />
<blockquote>
<h2>
  <a name="String_Recipes"> String Recipes </a>
</h2>
<p />
<ul>
<li> <a href="/Cookbook/StringChapter#String_Recipes">String Recipes</a>
<ul>
<li> <a href="/Cookbook/StringChapter#Introduction">Introduction </a>
</li>
<li> <a href="/Cookbook/StringChapter#Recipes">Recipes</a>
</li>
<li> <a href="/Cookbook/StringChapter#Other_recipes_of_interest">Other recipes of interest</a>
</li>
<li> <a href="/Cookbook/StringChapter#References">References</a>
</li>
</ul>
</li>
</ul>
</blockquote>
<p />
Requiring that chapters consist of sections which are stored in separate topics allows this duplication to be avoided, by working at the appropriate level.  As described in the <a href="/Cookbook/CookbookStructure#Overview">#Overview</a> above, this allows queries to choose whether they want to work with sections, or chapters, or both.  This is not possible if chapter topics are arbitrarily-constructed collections of content, such as a mix of headings at different levels and the use of <code>%TOC%</code> directives.
<p />
<h3>
  <a name="Ordering_of_chapters_sections_an"> Ordering of chapters, sections, and recipes. </a>
</h3>
<p />
To support control over ordering (sequencing) of chapters, sections, and recipes, the current plan, chosen for reasons of expedience, is to sort sibling topics according to the value of the <a href="/Cookbook/TopicOrder">TopicOrder</a> field in the <a href="/Cookbook/CookbookForm">CookbookForm</a>.
<p />
Combined with the above proposal, this takes care of an issue which otherwise arises in topics such as <a href="/Cookbook/RecipeIndex">RecipeIndex</a>: if sections and recipes are treated as siblings, then to interperse sections and recipes appropriately can require a total ordering on all recipes and sections in a chapter.  Currently, <a href="/Cookbook/RecipeIndex">RecipeIndex</a> only avoids this problem because existing Section topics all happen to be introductory ones that appear at the beginning of their chapters.
<p />
Under the proposal, recipes would appear within a section, not directly at the chapter level.  Sections would be sorted according to their <a href="/Cookbook/TopicOrder">TopicOrder</a>.  One of these sections would typically contain recipes, but the order of the recipes within the section would have no effect on the order of the sections.
<p />
Since there would typically be relatively few sections within a chapter, providing a total ordering on sections within chapters should not be onerous.
<p />
<h2>
  <a name="Implementation_plan"> Implementation plan </a>
</h2>
<p />
<ul>
<li> Split existing chapters into sections
</li>
<li> Archive existing chapter topics
</li>
<li> Replace chapter topics with query-based versions
</li>
<li> Profit!
</li>
</ul>
<p />
-- <a href="/Main/AntonVanStraaten">AntonVanStraaten</a> - 31 May 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Admin </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left">  </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left">  </td>
</tr>
</table>
<p />
 </div>
</div>
