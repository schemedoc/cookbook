<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Applicable_Hash_Tables"> Applicable Hash Tables </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You want to apply hash-table objects directly to look up or associate keys with values.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
You can rely on structures as procedures to wrap hash-tables:
<p />
<div class="scheme">
  <pre>(<span class="keyword">module</span> <span class="variable">hash</span> <span class="variable">mzscheme</span>
  (<span class="keyword">require</span> (<span class="variable">lib</span> <span class="selfeval">"match.ss"</span>)
           (<span class="variable">lib</span> <span class="selfeval">"contract.ss"</span>))
  (<span class="keyword">require-for-syntax</span> (<span class="variable">lib</span> <span class="selfeval">"cut.ss"</span> <span class="selfeval">"srfi"</span> <span class="selfeval">"26"</span>))
  (<span class="variable">define-values</span> (<span class="variable">struct:hash</span> <span class="variable">make-hash</span> <span class="variable">hash?</span> <span class="variable">hash-rec-ref</span> <span class="variable">hash-rec-set!</span>)
    (<span class="variable">make-struct-type</span> <span class="keyword">'</span><span class="variable">hash</span> <span class="selfeval">#f</span> <span class="selfeval">2</span> <span class="selfeval">0</span> <span class="selfeval">#f</span> <span class="variable">null</span> <span class="selfeval">#f</span> <span class="selfeval">1</span>))
  (<span class="keyword">define</span> (<span class="variable">hash</span> . <span class="variable">args</span>)
    (<span class="keyword">define</span> <span class="variable">h</span> (<span class="builtin">apply</span> <span class="variable">make-hash-table</span> <span class="variable">args</span>))
    (<span class="variable">make-hash</span> <span class="variable">h</span>
      (<span class="variable">case-lambda</span>
        [(<span class="variable">key</span>) (<span class="variable">hash-table-get</span> <span class="variable">h</span> <span class="variable">key</span>)]
        [(<span class="variable">key</span> <span class="variable">value</span>) (<span class="variable">hash-table-put!</span> <span class="variable">h</span> <span class="variable">key</span> <span class="variable">value</span>)])))
  (<span class="keyword">define</span> (<span class="variable">prim</span> <span class="variable">hash</span>) (<span class="variable">hash-rec-ref</span> <span class="variable">hash</span> <span class="selfeval">0</span>))
  (<span class="keyword">define-syntax</span> (<span class="variable">provide-prims</span> <span class="variable">stx</span>)
    (<span class="keyword">define</span> (<span class="variable">stx-prepend</span> <span class="variable">str</span> <span class="variable">stx</span>)
      (<span class="variable">datum-&gt;syntax-object</span> <span class="variable">stx</span>
                            (<span class="builtin">string-&gt;symbol</span>
                             (<span class="builtin">string-append</span> <span class="variable">str</span> (<span class="builtin">symbol-&gt;string</span> (<span class="variable">syntax-e</span> <span class="variable">stx</span>))))))
    (<span class="keyword">syntax-case</span> <span class="variable">stx</span> ()
      [(<span class="variable">_</span> <span class="variable">prims</span> ...)
       (<span class="keyword">let*</span> ([<span class="variable">prims</span> (<span class="variable">syntax-&gt;list</span> <span class="selfeval">#</span><span class="keyword">'</span>(<span class="variable">prims</span> ...))]
              [<span class="variable">mz-prims</span> (<span class="builtin">map</span> (<span class="variable">cut</span> <span class="variable">stx-prepend</span> <span class="selfeval">"hash-table-"</span> <span class="variable">&lt;&gt;</span>) <span class="variable">prims</span>)]
              [<span class="variable">my-prims</span> (<span class="builtin">map</span> (<span class="variable">cut</span> <span class="variable">stx-prepend</span> <span class="selfeval">"hash-"</span> <span class="variable">&lt;&gt;</span>) <span class="variable">prims</span>)]
              [<span class="variable">defs</span> (<span class="builtin">map</span> (<span class="keyword">lambda</span> (<span class="variable">my</span> <span class="variable">mz</span>)
                           <span class="selfeval">#</span><span class="keyword">`</span>(<span class="keyword">begin</span>
                               (<span class="keyword">define</span> (<span class="selfeval">#</span><span class="keyword">,</span><span class="variable">my</span> <span class="variable">hash</span> . <span class="variable">args</span>)
                                 (<span class="builtin">apply</span> <span class="selfeval">#</span><span class="keyword">,</span><span class="variable">mz</span> (<span class="variable">prim</span> <span class="variable">hash</span>) <span class="variable">args</span>))
                               (<span class="keyword">provide</span> <span class="selfeval">#</span><span class="keyword">,</span><span class="variable">my</span>)))
                         <span class="variable">my-prims</span> <span class="variable">mz-prims</span>)])
         <span class="selfeval">#</span><span class="keyword">`</span>(<span class="keyword">begin</span> <span class="selfeval">#</span><span class="keyword">,@</span><span class="variable">defs</span>))]))
  (<span class="variable">provide-prims</span> <span class="variable">copy</span> <span class="variable">count</span> <span class="builtin">for-each</span> <span class="variable">get</span>
                 <span class="variable">iterate-first</span> <span class="variable">iterate-key</span> <span class="variable">iterate-next</span> <span class="variable">iterate-value</span>
                 <span class="builtin">map</span> <span class="variable">put!</span> <span class="variable">remove!</span>)
  (<span class="variable">provide/contract</span>
    [<span class="variable">hash</span> ((<span class="variable">symbols</span> <span class="keyword">'</span><span class="variable">weak</span> <span class="keyword">'</span><span class="variable">equal</span>) . <span class="variable">-&gt;</span> . <span class="variable">hash?</span>)]
    [<span class="variable">hash?</span> (<span class="variable">any/c</span> . <span class="variable">-&gt;</span> . <span class="builtin">boolean?</span>)]))
</pre>
</div>
<p />
And then use it:
<p />
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">require</span> <span class="variable">hash</span>)
<span class="builtin">&gt;</span> (<span class="keyword">define</span> <span class="variable">h</span> (<span class="variable">hash</span> <span class="keyword">'</span><span class="variable">equal</span>))
<span class="builtin">&gt;</span> (<span class="variable">h</span> <span class="selfeval">"foo"</span> <span class="selfeval">2</span>)
<span class="builtin">&gt;</span> (<span class="variable">h</span> <span class="selfeval">"foo"</span>)
<span class="selfeval">2</span>
<span class="builtin">&gt;</span> (<span class="variable">hash-for-each</span> <span class="variable">h</span> (<span class="keyword">lambda</span> (<span class="variable">k</span> <span class="variable">v</span>) (<span class="variable">printf</span> <span class="selfeval">"~a: ~a~n"</span> <span class="variable">k</span> <span class="variable">v</span>)))
<span class="variable">foo:</span> <span class="selfeval">2</span>
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
<p />
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/DanielSilva">DanielSilva</a> - 05 Feb 2008
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/StructureRecipes">StructureRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
