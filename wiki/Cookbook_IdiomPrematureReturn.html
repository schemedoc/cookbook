<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Returning_prematurely_from_a_fun"> Returning prematurely from a function </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
You are either
<ul>
<li> porting code from an imperative language (like C) as
     literally as possible and they suddenly use <code>return</code> to
     return prematurely from a function.
</li>
<li> using a control struct such as <code>do</code>, <code>map</code>, <code>for-each</code>
     or <code>fold</code> and want to stop "before the end".
</li>
</ul>
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
The solution is to use an escape continuation.
The form <code>(let/ec escaper body ...)</code> binds to <code>escaper</code>
to a procedure of one argument, that when called will return
the argument as the result of the entire <code>let/ec</code> form.
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
A more Schemely example is multiplication of numbers.
This function muliplies the numbers in a list. The
function accumulates the result in the variable <code>product</code>.
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
Now one observes that if zero occurs in the list
the result will also be zero, no matter what
the remaining elements in the list are. The
form <code>let/ec</code> lets us add this case without
altering the structure of the code.
<p />
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
The difference between the two is illustrated by:
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
In plain R5RS you can use this definition:
500 Can't connect to 127.0.0.1:8778 (connect: Connection refused)
<p />
<p />
If your implementation provides escape continuations or one-shot continuations,
then using these will probably be more efficient.
<p />
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a>
<p />
<h3>
  <a name="Comments"> Comments </a>
</h3>
<p />
Probably some note should be made that C functions with premature <code>return</code> statements can be rewritten in Scheme using recursion and conditionals rather than explicit escape continuations.  I'm not sure what is a good way to do this, however, since any programmer skilled in a language without tail-call optimization has a healthy aversion to recursion when not absolutely necessary.  For PLT users for whom the Cookbook is an aid to migrating from another language, perhaps there should be topic like <span style="background : #FFFFCE;">
  <font color="#0000FF">IdiomRecursiveProgramming</font>
</span><a href="/edit/Cookbook/IdiomRecursiveProgramming?topicparent=Cookbook.IdiomPrematureReturn">?</a>, and this <a href="/Cookbook/IdiomPrematureReturn">IdiomPrematureReturn</a> topic should plug recursive programming as something "advanced" Scheme programmers generally do.  Although even programmers experienced in recursive programming sometimes find good use for <code>let/ec</code>.  (Perhaps I'm misrepresenting "advanced Scheme programmers" here.)
<p />
-- <a href="/Main/NeilVanDyke">NeilVanDyke</a> - 19 May 2004
<p />
I have changed the discussion a little to emphasize that <code>let/ec</code> can
be used in cases where you want to return prematurely from control struct
even when haven't got access to it's code.
(Which is why I chose a <code>do</code> loop and not a named let ;-) )
<p />
-- <a href="/Main/JensAxelSoegaard">JensAxelSoegaard</a> - 22 May 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/IdiomRecipes">IdiomRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left">  </td>
</tr>
</table>
<p />
 </div>
</div>
