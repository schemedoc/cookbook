<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="Reading_Lines_from_a_Text_File"> Reading Lines from a Text File </a>
</h2>
<p />
PLT Scheme offers the <code>read-line</code> procedure for reading lines of text from an input port.
The following are some useful procedures which use read-line to make it easy to process
an entire file, one line at a time.  This code was adapted from the comp.lang.scheme thread,
<a href="http://groups.google.com/groups?threadm=v6d5lslrvqnha5%40corp.supernews.com" target="_top">How to read lines from a text file</a>.
<p />
<h3>
  <a name="Simple_iterative_version"> Simple iterative version </a>
</h3>
<p />
The following is a straightforward implementation which allows the programmer to provide a procedure which will be called with each new line read from a file.
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">for-each-line-in-file</span> <span class="variable">filename</span> <span class="variable">proc</span> . <span class="variable">mode</span>)
  (<span class="builtin">with-input-from-file</span>
   <span class="variable">filename</span>
   (<span class="keyword">lambda</span> () (<span class="builtin">apply</span> <span class="variable">for-each-line</span> <span class="variable">proc</span> (<span class="builtin">current-input-port</span>) <span class="variable">mode</span>))))
(<span class="keyword">define</span> (<span class="variable">for-each-line</span> <span class="variable">proc</span> . <span class="variable">port+mode</span>)
  (<span class="keyword">let</span> <span class="variable">while</span> ()
    (<span class="keyword">let</span> ((<span class="variable">line</span> (<span class="builtin">apply</span> <span class="variable">read-line</span> <span class="variable">port+mode</span>)))
      (<span class="keyword">unless</span> (<span class="builtin">eof-object?</span> <span class="variable">line</span>)
        (<span class="variable">proc</span> <span class="variable">line</span>)
        (<span class="variable">while</span>)))))
</pre>
</div>
<p />
<p />
For documentation of the optional <code>mode</code> and <code>port+mode</code> parameters, see the
<a href="http://download.plt-scheme.org/doc/206p1/html/mzscheme/mzscheme-Z-H-11.html#node_sec_11.2.1" target="_top">PLT read-line documentation</a>.
<p />
<h4>
  <a name="Example"> Example </a>
</h4>
<p />
The following will display the source code from the file <code>ReadingLines.scm</code>, with line numbers.
<p />
<div class="scheme">
  <pre>(<span class="variable">for-each-line-in-file</span>
  <span class="selfeval">"ReadingLines.scm"</span>
  (<span class="keyword">let</span> ((<span class="variable">line-num</span> <span class="selfeval">0</span>))
    (<span class="keyword">lambda</span> (<span class="variable">line</span>)
      (<span class="variable">printf</span> <span class="selfeval">"~a: ~a ~n"</span> <span class="variable">line-num</span> <span class="variable">line</span>)
      (<span class="keyword">set!</span> <span class="variable">line-num</span> (<span class="variable">add1</span> <span class="variable">line-num</span>)))))
</pre>
</div>
<p />
<p />
<h3>
  <a name="Functional_Version"> Functional Version </a>
</h3>
<p />
In the above example, the <code>line-num</code> variable is mutated on each line.  The design of <code>for-each-line</code> does not allow for state to be accumulated as reading progresses, so it is necessary to set up external state (using <code>let</code> in the above example) and mutate that state within the user-supplied procedure.
<p />
The standard functional programming idiom to deal with this situation is a <code>fold</code>, which is a functional generalization of iteration.  Here are folding versions of the above functions:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">fold-lines-in-file</span> <span class="variable">filename</span> <span class="variable">proc</span> <span class="variable">init</span> . <span class="variable">mode</span>)
  (<span class="builtin">with-input-from-file</span>
   <span class="variable">filename</span>
   (<span class="keyword">lambda</span> () (<span class="builtin">apply</span> <span class="variable">fold-lines</span> <span class="variable">proc</span> <span class="variable">init</span> (<span class="builtin">current-input-port</span>) <span class="variable">mode</span>))))
(<span class="keyword">define</span> (<span class="variable">fold-lines</span> <span class="variable">proc</span> <span class="variable">init</span> . <span class="variable">port+mode</span>)
  (<span class="keyword">let</span> <span class="variable">while</span> ((<span class="variable">accum</span> <span class="variable">init</span>))
    (<span class="keyword">let</span> ((<span class="variable">line</span> (<span class="builtin">apply</span> <span class="variable">read-line</span> <span class="variable">port+mode</span>)))
      (<span class="keyword">if</span> (<span class="builtin">eof-object?</span> <span class="variable">line</span>) <span class="variable">accum</span>
          (<span class="variable">while</span> (<span class="variable">proc</span> <span class="variable">line</span> <span class="variable">accum</span>))))))
</pre>
</div>
<p />
<p />
Although these functions are similar in size and complexity to the previous versions, they are more powerful because they allow state to be passed from one invocation of the user-supplied procedure to the next.
<p />
<h4>
  <a name="Example"> Example </a>
</h4>
<p />
The above functions allow the previous example to be rewritten more simply, as follows:
<p />
<div class="scheme">
  <pre>(<span class="variable">fold-lines-in-file</span>
  <span class="selfeval">"ReadingLinesWithFold.scm"</span>
  (<span class="keyword">lambda</span> (<span class="variable">line</span> <span class="variable">line-num</span>)
    (<span class="variable">printf</span> <span class="selfeval">"~a: ~a ~n"</span> <span class="variable">line-num</span> <span class="variable">line</span>)
    (<span class="variable">add1</span> <span class="variable">line-num</span>))
  <span class="selfeval">1</span>)
</pre>
</div>
<p />
<p />
Notice that line numbering is achieved without needing to mutate a variable.  The user-supplied procedure simply accepts a <code>line-num</code> argument, and when it's done, returns the next value for that argument.  The initial line number is supplied as the last argument to <code>fold-lines-in-file</code>.
<p />
This general pattern is used by all <code>fold</code> operations, such as the canonical <code>
  <a href="http://download.plt-scheme.org/doc/206p1/html/mzlib/mzlib-Z-H-21.html#node_idx_744" target="_top">foldl</a>
</code> function for folding over lists.
<p />
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/AntonVanStraaten">AntonVanStraaten</a> - 03 Apr 2004
<p />
See comp.lang.scheme thread for other contributors
<p />
<h3>
  <a name="Comments"> Comments </a>
</h3>
<p />
Source code is in: <a href="/Scm/ReadingLines">ReadingLines</a>, <a href="/Scm/ReadingLinesSample">ReadingLinesSample</a>, <a href="/Scm/ReadingLinesWithFold">ReadingLinesWithFold</a>, <a href="/Scm/ReadingLinesWithFoldSample">ReadingLinesWithFoldSample</a>
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/FileRecipes">FileRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left">  </td>
</tr>
</table>
<p />
 </div>
</div>
