<div id="contentbox">
 <div class="widget">
  <p />
<h2><a name="Converting_Between_struct_time_a"> </a> Converting Between struct:time and ISO-8601 Format </h2>
<h3>
  <a name="Problem"> Problem </a>
</h3>
You have an application that requires you to use ISO-8601 Format for input and output.
<h3>
  <a name="Solution"> Solution </a>
</h3>
mzlib defines <code>date-&gt;string</code> and <code>string-&gt;date</code> which produces output conformant with a profile of ISO 8061:
<div class="scheme">
  <pre><span class="builtin">&gt;</span> (<span class="keyword">require</span> (<span class="variable">lib</span> <span class="selfeval">"date.ss"</span>))
<span class="builtin">&gt;</span> (<span class="variable">date-display-format</span> <span class="keyword">'</span><span class="variable">iso-8601</span>)
<span class="builtin">&gt;</span> (<span class="variable">date-&gt;string</span> (<span class="variable">seconds-&gt;date</span> (<span class="variable">current-seconds</span>)) <span class="selfeval">#t</span>)
<span class="selfeval">"2004-04-28 10:34:19"</span>
</pre>
</div>
However, if you're writing a web application, you may need to observe the W3C profile for time formats, which is slightly different.  The following methods define formatting and parsing for full ISO 8601 dates and times:
<p />
<div class="scheme">
  <pre>(<span class="keyword">require</span> (<span class="variable">lib</span> <span class="selfeval">"string.ss"</span> <span class="selfeval">"srfi"</span> <span class="selfeval">"13"</span>)
         (<span class="variable">prefix</span> <span class="variable">time:</span> (<span class="variable">lib</span> <span class="selfeval">"time.ss"</span> <span class="selfeval">"srfi"</span> <span class="selfeval">"19"</span>)))
(<span class="keyword">define</span> (<span class="variable">date-&gt;iso8601</span> <span class="variable">dt</span>)
  (<span class="keyword">let</span> ((<span class="variable">tzoff</span> (<span class="builtin">/</span> (<span class="variable">time:date-zone-offset</span> <span class="variable">dt</span>) <span class="selfeval">3600</span>)))
    (<span class="variable">format</span> <span class="selfeval">"~A~A~A:~A"</span>
           (<span class="variable">time:date-&gt;string</span> <span class="variable">dt</span> <span class="selfeval">"~Y-~m-~dT~H:~M:~S"</span>)
           (<span class="keyword">if</span> (<span class="builtin">&lt;</span> <span class="variable">tzoff</span> <span class="selfeval">0</span>) <span class="selfeval">"-"</span> <span class="selfeval">""</span>)
           (<span class="variable">string-pad</span> (<span class="builtin">number-&gt;string</span> (<span class="builtin">abs</span> <span class="variable">tzoff</span>)) <span class="selfeval">2</span> <span class="selfeval">#\0</span>)
           <span class="selfeval">"00"</span>)))
(<span class="keyword">define</span> (<span class="variable">iso8601-&gt;date</span> <span class="variable">str</span>)
  (<span class="variable">time:make-date</span> <span class="selfeval">0</span>
                  (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">17</span> <span class="selfeval">19</span>))
                  (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">14</span> <span class="selfeval">16</span>))
                  (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">11</span> <span class="selfeval">13</span>))
                  (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">8</span> <span class="selfeval">10</span>))
                  (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">5</span> <span class="selfeval">7</span>))
                  (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">0</span> <span class="selfeval">4</span>))
                  (<span class="keyword">if</span> (<span class="builtin">char=?</span> (<span class="builtin">string-ref</span> <span class="variable">str</span> <span class="selfeval">19</span>) <span class="selfeval">#\Z</span>)
                      <span class="selfeval">0</span>
                      (<span class="builtin">-</span> (<span class="builtin">+</span> (<span class="builtin">*</span> (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">20</span> <span class="selfeval">22</span>)) <span class="selfeval">3600</span>)
                            (<span class="builtin">*</span> (<span class="builtin">string-&gt;number</span> (<span class="variable">substring/shared</span> <span class="variable">str</span> <span class="selfeval">23</span> <span class="selfeval">25</span>)) <span class="selfeval">60</span>))))))
</pre>
</div>
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
The nice thing about the W3C profile of the ISO 8601 format is that it's very easy to sort dates using a simple string compare.
<h3>
  <a name="References"> References </a>
</h3>
<ul>
<li> <a href="http://www.iso.ch/iso/en/prods-services/popstds/datesandtime.html" target="_top">ISO 8601 Dates and Times</a>
</li>
<li> <a href="http://www.w3.org/TR/NOTE-datetime" target="_top">W3C Date and Time Formats</a>
</li>
</ul>
<p />
<p />
<p />
-- <a href="/Main/GordonWeakliem">GordonWeakliem</a> - 28 Apr 2004
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/TimeRecipes">TimeRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 060 </td>
</tr>
</table>
<p />
 </div>
</div>
