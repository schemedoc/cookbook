<div id="contentbox">
 <div class="widget">
  <p />
<h2>
  <a name="The_Post_Redirect_Get_Pattern"> The Post-Redirect-Get Pattern </a>
</h2>
<p />
<h3>
  <a name="Problem"> Problem </a>
</h3>
<p />
When displaying a page after receiving a form submission, the browser's "refresh" button should not repost the form results.
<p />
<h3>
  <a name="Solution"> Solution </a>
</h3>
<p />
The "Post-Redirect-Get" pattern, or PRG, is a popular web idiom for displaying a page after receiving a form ("POST") submission. The only action performed by the response to form submission is to redirect to an ordinary ("GET") page. This can be abstracted particularly nicely in PLT Scheme with the following simple procedure:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">redirect/get</span>)
  (<span class="variable">send/suspend</span>
    (<span class="keyword">lambda</span> (<span class="variable">k-url</span>)
      (<span class="variable">redirect-to</span> <span class="variable">k-url</span>))))
</pre>
</div>
<p />
Now client code can simply apply this procedure after a form submission to redirect users to a "GET" page:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define</span> (<span class="variable">start</span> <span class="variable">initial-request</span>)
  (<span class="keyword">let</span> ([<span class="variable">request</span> (<span class="variable">send/suspend</span>
                   (<span class="keyword">lambda</span> (<span class="variable">k-url</span>)
                     ... <span class="variable">form</span> ...))])
    (<span class="variable">redirect/get</span>)
    (<span class="keyword">let</span> ([<span class="variable">user</span> (<span class="variable">extract-binding/single</span> <span class="keyword">'</span><span class="variable">user</span> (<span class="variable">request-bindings</span> <span class="variable">request</span>))])
      <span class="keyword">`</span>(<span class="variable">html</span> (<span class="variable">head</span> (<span class="variable">title</span> <span class="selfeval">"Hi"</span>))
             (<span class="variable">body</span> (<span class="variable">p</span> <span class="selfeval">"Hi, "</span> <span class="keyword">,</span><span class="variable">user</span> <span class="selfeval">"! Hit refresh!"</span>))))))
</pre>
</div>
<p />
<h3>
  <a name="Discussion"> Discussion </a>
</h3>
<p />
Note that the <code>redirect/get</code> procedure returns the <code>request</code> object as a result of the "GET" interaction, though most of the time there won't be any interesting information in this <code>request</code> object that wasn't already in the result of the "POST".
<p />
My first implementation was as a special form, implemented as a simple macro whose subexpressions are evaluated in the context of the redirected GET page:
<p />
<div class="scheme">
  <pre>(<span class="keyword">define-syntax</span> <span class="variable">redirect/get</span>
  (<span class="keyword">syntax-rules</span> ()
    [(<span class="variable">_</span> <span class="variable">e</span> ...)
     (<span class="variable">send/suspend/dispatch</span>
       (<span class="keyword">lambda</span> (<span class="variable">embed/url</span>)
         (<span class="variable">redirect-to</span> (<span class="variable">embed/url</span> (<span class="keyword">lambda</span> (<span class="variable">_</span>) <span class="variable">e</span> ...)))))]))
</pre>
</div>
<p />
(This solution makes use of the <code>send/suspend/dispatch</code> procedure discussed in <a href="/Cookbook/WebDispatchOnLink">WebDispatchOnLink</a>.)
<p />
However, I believe the solution using <code>send/suspend</code> is even easier to use and understand as a library procedure.
<p />
<h3>
  <a name="See_also_"> See also: </a>
</h3>
<p />
<a href="http://www.theserverside.com/articles/article.tss?l=RedirectAfterPost" target="_top">http://www.theserverside.com/articles/article.tss?l=RedirectAfterPost</a>
<p />
<p />
<hr>
<p />
<h3>
  <a name="Comments_about_this_recipe"> Comments about this recipe </a>
</h3>
<p />
<h3>
  <a name="Contributors"> Contributors </a>
</h3>
<p />
-- <a href="/Main/DaveHerman">DaveHerman</a> - 30 Sep 2005
<p />
Changed to the simpler implementation with <code>send/suspend</code>.
<p />
-- <a href="/Main/DaveHerman">DaveHerman</a> - 02 Oct 2005
  <p />
<table border="1" cellspacing="0" cellpadding="0">
   <tr>
  <th colspan="2" align="center" bgcolor="#99CCCC"> <a href="/Cookbook/CookbookForm">CookbookForm</a> </th>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicType">TopicType</a>:</th>
  <td align="left"> Recipe </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/ParentTopic">ParentTopic</a>:</th>
  <td align="left"> <a href="/Cookbook/WebRecipes">WebRecipes</a> </td>
</tr>
<tr>
  <th bgcolor="#99CCCC" align="right"> <a href="/Cookbook/TopicOrder">TopicOrder</a>:</th>
  <td align="left"> 999 </td>
</tr>
</table>
<p />
 </div>
</div>
